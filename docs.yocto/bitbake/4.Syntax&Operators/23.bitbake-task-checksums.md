# 태스크 체크섬과 셋씬 (Task Checksums and Setscene)

BitBake는 빌드 속도를 최적화하기 위해 이전에 수행된 작업의 결과를 재사용합니다. 이를 위해 각 태스크의 입력값을 기반으로 고유한 체크섬(Signature)을 계산하고, 이를 캐시된 결과(Shared State)와 비교합니다.

## 4.12.1 태스크 체크섬 (Task Checksums)

BitBake는 태스크를 실행하기 전에 해당 태스크의 '지문'에 해당하는 체크섬을 계산합니다. 이 체크섬이 변경되지 않았다면, 입력값이 동일하므로 출력값도 동일할 것이라고 가정합니다.

### 체크섬 계산 요소
체크섬은 다음 요소들을 포함하여 계산됩니다.
1.  **태스크 코드**: 실행될 셸 스크립트나 파이썬 함수의 내용.
2.  **변수 값**: 태스크 코드 내에서 참조되는 모든 BitBake 변수의 값.
3.  **의존성**: `DEPENDS`나 `RDEPENDS` 등을 통해 연결된 이전 태스크들의 체크섬.
4.  **파일 체크섬**: `SRC_URI`에 지정된 로컬 파일이나 패치 파일의 내용 해시.

### 디버깅 도구
체크섬이 왜 변경되었는지, 또는 왜 두 빌드 간에 체크섬이 다른지 분석하기 위해 다음 도구들을 사용할 수 있습니다.
*   `bitbake-dumpsig`: 시그니처 데이터 파일(`sigdata`)의 내용을 사람이 읽을 수 있는 형태로 출력합니다.
*   `bitbake-diffsigs`: 두 개의 시그니처 데이터 파일을 비교하여 어떤 변수나 의존성이 변경되었는지 보여줍니다.

## 4.12.2 셋씬 (Setscene)

셋씬(Setscene)은 "Setup Scene"의 약자로, 실제 태스크(`do_compile` 등)를 실행하는 대신 미리 빌드된 아티팩트를 가져와서 빌드 상태를 "설정"하는 과정입니다. 이는 Yocto Project의 **Sstate (Shared State) Cache** 메커니즘의 핵심입니다.

### 동작 방식
1.  BitBake는 태스크의 체크섬을 계산합니다.
2.  해당 체크섬에 해당하는 아티팩트가 Sstate 캐시(로컬 디렉토리 또는 원격 미러)에 존재하는지 확인합니다.
3.  **캐시 히트**: 존재한다면, 실제 태스크 실행을 건너뛰고 `do_taskname_setscene`이라는 특수 태스크를 실행하여 캐시된 결과물을 압축 해제하고 설치합니다.
4.  **캐시 미스**: 존재하지 않는다면, 일반적인 `do_taskname`을 실행하여 직접 빌드하고, 그 결과를 Sstate 캐시에 저장합니다(설정된 경우).

이 과정을 통해 클린 빌드 시에도 컴파일 시간을 획기적으로 단축할 수 있습니다.

### 셋씬 태스크 식별
로그나 콘솔 출력에서 `do_populate_sysroot_setscene`과 같이 `_setscene` 접미사가 붙은 태스크가 실행된다면, 이는 실제 빌드 대신 캐시된 결과를 가져오고 있다는 의미입니다.
