# 의존성 (Dependencies)

BitBake가 효율적인 병렬 빌드를 수행하고 올바른 실행 순서를 보장하기 위해서는 레시피와 태스크 간의 의존성(Dependencies)을 정확하게 정의하는 것이 필수적입니다.

## 4.10.1 .bb 파일 내부의 의존성 (Dependencies Internal to the .bb File)

BitBake는 하나의 레시피 내에서 태스크들이 실행되는 기본 순서를 관리합니다. 예를 들어, 소스 코드를 컴파일(`do_compile`)하기 전에 설정(`do_configure`)이 완료되어야 하고, 설정 전에는 패치(`do_patch`)가 적용되어야 합니다.

이러한 순서는 주로 `base.bbclass`나 다른 클래스 파일들에서 `addtask` 명령어를 통해 정의되어 있습니다.

```bitbake
addtask configure after do_patch before do_compile
```

## 4.10.2 빌드 의존성 (Build Dependencies)

**빌드 의존성**은 소프트웨어를 컴파일하고 링크하는 시점에 필요한 라이브러리나 도구들을 의미합니다. `DEPENDS` 변수를 사용하여 정의합니다.

*   **변수**: `DEPENDS`
*   **대상**: 레시피 이름 (Recipe Name) 또는 제공자 이름 (Provider Name)
*   **동작**: 지정된 레시피들의 `do_populate_sysroot` 태스크가 현재 레시피의 `do_configure` 태스크보다 먼저 완료되도록 보장합니다. 이를 통해 필요한 헤더 파일과 라이브러리가 빌드용 sysroot에 준비됩니다.

```bitbake
DEPENDS = "autoconf-native zlib openssl"
```

## 4.10.3 런타임 의존성 (Runtime Dependencies)

**런타임 의존성**은 타겟 시스템에서 프로그램이 실제로 실행될 때 필요한 패키지들을 의미합니다. `RDEPENDS` 변수를 사용하여 정의합니다.

*   **변수**: `RDEPENDS`
*   **대상**: 패키지 이름 (Package Name). 레시피 이름과 다를 수 있습니다.
*   **적용**: 반드시 패키지별로 지정해야 하므로, 변수 뒤에 패키지 이름(주로 `${PN}`)을 붙여야 합니다.
*   **동작**: 패키지 매니저(RPM, IPK, DEB)가 패키지를 설치할 때 이 의존성을 확인하여 함께 설치합니다.

```bitbake
RDEPENDS:${PN} = "bash perl libcurl"
```

> **참고**: 많은 경우 빌드 시 링크된 라이브러리는 `shlibdeps` 메커니즘에 의해 자동으로 런타임 의존성으로 추가되므로, 명시적으로 `RDEPENDS`에 적지 않아도 되는 경우가 많습니다.

## 4.10.4 재귀적 의존성 (Recursive Dependencies)

BitBake는 `DEPENDS`와 `RDEPENDS`를 통해 연결된 모든 의존성 체인을 추적합니다. 만약 A가 B를 필요로 하고, B가 C를 필요로 한다면, A를 빌드하기 위해 C와 B가 순서대로 먼저 빌드됩니다.

## 4.10.5 태스크 간 의존성 (Inter-Task Dependencies)

레시피 간의 단순한 빌드/런타임 의존성을 넘어, 특정 태스크 간의 정교한 의존성 제어가 필요한 경우도 있습니다.

### `[depends]` 플래그

특정 태스크가 다른 레시피의 특정 태스크 완료 후에 실행되어야 함을 명시합니다.

```bitbake
# 현재 레시피의 do_configure는 virtual/kernel 레시피의 do_shared_workdir가 완료된 후 실행됨
do_configure[depends] += "virtual/kernel:do_shared_workdir"
```

### `[deptask]` 플래그

현재 레시피의 특정 태스크가, `DEPENDS`나 `RDEPENDS`에 나열된 모든 의존성 대상들의 특정 태스크가 완료된 후 실행되어야 함을 지정합니다.

```bitbake
# do_package 태스크는 RDEPENDS에 있는 모든 패키지의 do_package 태스크가 완료된 후 실행됨
do_package[deptask] = "do_package"
```
