# 함수 (Functions)

BitBake 레시피에서는 셸(Shell) 스크립트와 파이썬(Python) 코드를 모두 사용하여 함수를 정의할 수 있습니다. 이를 통해 빌드 로직을 모듈화하고 재사용할 수 있습니다.

## 4.5.1 셸 함수 (Shell Functions)

가장 흔하게 사용되는 형태입니다. `sh` 또는 `bash` 문법을 따르며, 주로 파일 복사, 컴파일 명령 실행 등의 작업에 사용됩니다.

```bitbake
some_function () {
    echo "Hello World"
}
```

## 4.5.2 BitBake 스타일 파이썬 함수 (BitBake-Style Python Functions)

BitBake 내부 데이터 저장소(Datastore)와 상호작용하거나 복잡한 로직을 처리할 때 사용됩니다. `python` 키워드를 함수 이름 앞에 붙여 정의합니다. `d` 변수(Datastore)를 통해 변수에 접근할 수 있습니다.

```bitbake
python some_python_function () {
    d.setVar("TEXT", "Hello World")
    print(d.getVar("TEXT"))
}
```

## 4.5.3 파이썬 함수 (Python Functions)

일반적인 파이썬 모듈처럼 `def` 키워드를 사용하여 정의합니다. 주로 유틸리티 함수나 클래스 내부 로직을 작성할 때 사용됩니다. `d` 객체는 자동으로 전달되지 않으므로 필요한 경우 인자로 받아야 합니다.

```bitbake
def get_depends(d):
    if d.getVar('SOMECONDITION'):
        return "dependencywithcond"
    return "dependency"

VAR = "${@get_depends(d)}"
```

## 4.5.4 BitBake 스타일 파이썬 함수 vs 파이썬 함수

- **BitBake 스타일**: `python funcname() { ... }` 형태. `d` 변수가 전역적으로 사용 가능. 주로 태스크(Task)로 실행되거나 이벤트 핸들러로 사용됩니다.
- **일반 파이썬**: `def funcname(args): ...` 형태. 모듈 내 함수처럼 동작. 변수 확장식(`${@...}`) 내부에서 호출하여 값을 리턴받는 용도로 자주 사용됩니다.

## 4.5.5 익명 파이썬 함수 (Anonymous Python Functions)

이름 없이 `python () { ... }` 또는 `python { ... }` 형태로 정의됩니다. 레시피 파싱이 끝나는 시점에 자동으로 실행됩니다. 변수 값을 동적으로 설정하거나, 특정 조건에 따라 빌드 설정을 변경할 때 매우 유용합니다.

```bitbake
python () {
    if d.getVar('SOME_VAR') == 'value':
        d.setVar('ANOTHER_VAR', 'new_value')
}
```

## 4.5.6 클래스 함수의 유연한 상속 (Flexible Inheritance for Class Functions)

`EXPORT_FUNCTIONS`를 사용하여 클래스(`.bbclass`)에서 정의된 함수를 레시피에서 오버라이드하면서도, 필요할 때 원본 함수를 호출할 수 있게 합니다.

**클래스 파일 (myclass.bbclass):**

```bitbake
myclass_do_configure() {
    echo "Running default configure"
}

EXPORT_FUNCTIONS do_configure
```

**레시피 파일:**

```bitbake
inherit myclass

do_configure() {
    echo "Before configure"
    myclass_do_configure
    echo "After configure"
}
```
