# BitBake 스타일 파이썬 함수 (BitBake-Style Python Functions)

BitBake 스타일 파이썬 함수는 셸 스크립트로는 처리하기 어려운 복잡한 로직을 수행하거나, BitBake의 데이터 저장소(Datastore)와 직접 상호작용해야 할 때 사용됩니다. 이 함수들은 `python` 키워드로 시작하며, BitBake 실행 환경 내에서 파이썬 코드로 실행됩니다.

## 4.5.2 함수 정의 (Defining Functions)

`python` 키워드를 함수 이름 앞에 붙이고, 함수 본문을 중괄호 `{}`로 감싸서 정의합니다.

```bitbake
python my_python_function () {
    # Python code goes here
    bb.plain("This is a BitBake-style Python function.")
}
```

## 4.5.2.1 `d` 데이터 저장소 객체 (The `d` Datastore Object)

BitBake 스타일 파이썬 함수의 가장 큰 특징은 `d`라는 특별한 객체에 접근할 수 있다는 점입니다. `d`는 현재 레시피의 데이터 저장소(Datastore)를 나타내며, 변수를 읽고 쓰는 데 사용됩니다.

**주요 메서드:**

*   `d.getVar('VARNAME')`: 변수 `VARNAME`의 값을 가져옵니다.
*   `d.setVar('VARNAME', 'value')`: 변수 `VARNAME`의 값을 'value'로 설정합니다.
*   `d.appendVar('VARNAME', ' value')`: 변수 `VARNAME`의 끝에 값을 추가합니다. (앞에 공백 추가)
*   `d.prependVar('VARNAME', 'value ')`: 변수 `VARNAME`의 시작에 값을 추가합니다. (뒤에 공백 추가)
*   `bb.utils.contains('VAR', 'value', 'true_val', 'false_val', d)`: `VAR`에 `value`가 포함되어 있는지 확인하고 조건부 값을 반환합니다.

```bitbake
python do_show_vars () {
    pn = d.getVar('PN')
    pv = d.getVar('PV')
    bb.note(f"Package Name: {pn}")
    bb.note(f"Package Version: {pv}")

    d.setVar('MY_VAR', 'my-value')
}
```

## 4.5.2.2 사용 사례 (Use Cases)

*   **태스크 구현 (Implementing Tasks):** 셸 명령만으로 부족할 때 파이썬의 풍부한 라이브러리를 활용하여 태스크를 구현할 수 있습니다.

    ```bitbake
    python do_generate_config() {
        version = d.getVar('PV')
        with open(d.getVar('S') + '/config.h', 'w') as f:
            f.write(f'#define VERSION "{version}"\n')
    }
    addtask do_generate_config after do_unpack before do_configure
    ```

*   **이벤트 핸들러 (Event Handlers):** 특정 빌드 이벤트가 발생했을 때 실행될 코드를 정의합니다.

    ```bitbake
    python my_event_handler(e):
        bb.note(f"Event {e.type} occurred for {e.pn}")

    addhandler my_event_handler
    ```

## 4.5.2.3 함수 수정 및 확장 (Modifying Functions)

셸 함수와 마찬가지로 `:append`와 `:prepend`를 사용하여 기존 파이썬 함수의 내용을 확장할 수 있습니다. BitBake는 각 코드 조각을 별도의 파이썬 함수로 감싼 후 순서대로 호출합니다.

```bitbake
python do_my_task() {
    bb.note("Original task")
}

do_my_task:append() {
    bb.note("Appended python code")
}
```

위 예제에서 `do_my_task`가 실행되면 "Original task"와 "Appended python code"가 순서대로 출력됩니다.
