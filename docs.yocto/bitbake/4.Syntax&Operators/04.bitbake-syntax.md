# BitBake 문법과 연산자 (Syntax and Operators)

BitBake 언어는 변수 정의, 실행 가능한 셸 및 Python 코드, 그리고 실행 흐름을 제어하는 지시어(Directives)로 구성됩니다. 레시피를 작성하거나 수정할 때 가장 빈번하게 사용되는 기본 문법들을 설명합니다.

## 4.1 기본 문법 (Basic Syntax)

### 4.1.1 기본 변수 설정 (Basic Variable Setting)

변수 할당은 기본적으로 셸 스크립트와 유사하지만 몇 가지 중요한 차이점이 있습니다.

```bitbake
VARIABLE = "value"
```

### 4.1.2 변수 확장 (Variable Expansion)

변수의 값을 참조할 때는 `${VARNAME}` 문법을 사용합니다.

```bitbake
A = "aval"
B = "pre${A}post"
# B는 "preavalpost"가 됩니다.
```

### 4.1.3 기본값 설정 (?=)

`?=` 연산자는 변수가 **이전에 설정되지 않은 경우에만** 값을 할당합니다. (Soft assignment)

```bitbake
A ?= "default"
A = "override"
# A는 "override"가 됩니다.

B ?= "default"
# B는 "default"가 됩니다.
```

### 4.1.4 약한 기본값 설정 (??=)

`??=` 연산자는 파싱 과정이 모두 끝날 때까지 변수가 설정되지 않은 경우에 적용되는 "약한(Weak)" 기본값입니다. 여러 `??=` 할당이 있을 경우, 마지막에 파싱된 것이 적용됩니다. `?=`보다 우선순위가 낮습니다.

### 4.1.5 즉시 변수 확장 (:=)

일반적인 `=` 할당은 변수가 실제로 사용될 때 값이 확장(Lazy Expansion)됩니다. 반면 `:=`는 할당되는 **그 시점**의 값으로 즉시 확장(Immediate Expansion)됩니다.

```bitbake
T = "123"
A := "${T}"
T = "456"
# A는 여전히 "123"입니다. (즉시 확장되었으므로)
# 만약 A = "${T}" 였다면, A는 "456"이 됩니다.
```

### 4.1.6 공백을 포함한 추가/병합 (+=, =+)

*   `+=`: 변수의 현재 값 **뒤에** 공백 한 칸을 추가하고 값을 덧붙입니다.
*   `=+`: 변수의 현재 값 **앞에** 공백 한 칸을 추가하고 값을 덧붙입니다.

```bitbake
B = "bval"
B += "additional"
# B는 "bval additional"
```

### 4.1.7 공백 없는 추가/병합 (.=, =.)

*   `.=`: 변수의 현재 값 **뒤에** 공백 없이 값을 덧붙입니다.
*   `=.`: 변수의 현재 값 **앞에** 공백 없이 값을 덧붙입니다.

```bitbake
B = "bval"
B .= "additional"
# B는 "bvaladditional"
```

### 4.1.8 오버라이드 스타일 추가/병합 (:append, :prepend)

`:append`와 `:prepend` 연산자는 변수 값의 끝이나 시작 부분에 값을 추가합니다. 이 연산자들은 **공백을 자동으로 추가하지 않습니다**. 또한, 이 연산자들은 변수 할당(`=`, `?=`)이 모두 처리된 후에 적용됩니다.

```bitbake
FOO = "foo"
FOO:append = "bar"
# FOO는 "foobar"가 됩니다.
```

### 4.1.9 오버라이드 스타일 제거 (:remove)

`:remove` 연산자는 리스트(공백으로 구분된 값)에서 특정 값을 제거합니다.

```bitbake
FOO = "123 456 789 123456"
FOO:remove = "123"
FOO:remove = "456"
# FOO는 " 789 123456"이 됩니다. (정확히 일치하는 단어만 제거)
```

### 4.1.10 인라인 파이썬 변수 확장 (Inline Python Variable Expansion)

`${@python_code}` 구문을 사용하여 Python 코드를 실행하고, 그 리턴값을 변수에 할당할 수 있습니다.

```bitbake
DATE = "${@time.strftime('%Y%m%d', time.gmtime())}"
```

```bitbake
DATE = "${@time.strftime('%Y%m%d', time.gmtime())}"
```

### 4.1.11 오버라이드 스타일 연산의 장점 (Override Style Operation Advantages)

:append, :prepend, :remove와 같은 오버라이드 스타일 연산자는 단순한 편의 기능을 넘어, BitBake의 변수 처리 방식에서 중요한 이점을 제공합니다.

* 지연된 적용 (Deferred Application): 이 연산자들은 레시피 파싱이 완료된 후, 변수가 실제로 사용(확장)되기 직전에 적용됩니다. 따라서 local.conf나 .bbappend 파일에서 변수를 수정할 때, 원본 레시피의 연산 순서에 구애받지 않고 값을 확실하게 추가하거나 제거할 수 있습니다.
* 무조건적 적용 (Unconditional Application): ?= (기본값 설정) 연산자와 함께 사용될 때 유용합니다. 일반적인 += 연산은 변수가 나중에 =로 덮어써지면 무시될 수 있지만, :append는 변수의 최종 값에 무조건 적용됩니다.

```bitbake
  FOO ?= "default" 
  FOO:append = " appended" 
  # 나중에 FOO = "overridden"이 되어도 결과는 "overridden appended"가 됩니다.
```
