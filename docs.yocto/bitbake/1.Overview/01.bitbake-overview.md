# BitBake 개요 (Overview)

## 1.1 소개 (Introduction)

BitBake는 Yocto Project와 OpenEmbedded 생태계의 핵심 빌드 엔진입니다. `make` 유틸리티와 개념적으로 유사하지만, 임베디드 리눅스 시스템 빌드라는 특정 목적에 맞춰 훨씬 더 강력하고 유연하게 설계되었습니다.

BitBake의 주된 역할은 다음과 같습니다.
- **메타데이터 파싱**: 레시피(`.bb`), 클래스(`.bbclass`), 설정 파일(`.conf`) 등 다양한 형식의 메타데이터를 읽고 해석합니다.
- **의존성 분석**: 태스크(Task) 간의 복잡한 빌드 시점 및 런타임 시점 의존성을 분석하여 실행 순서를 결정합니다.
- **태스크 실행**: 소스 코드 다운로드, 압축 해제, 패치, 설정, 컴파일, 패키징, 이미지 생성 등 정의된 태스크들을 순서에 맞게 실행합니다.

BitBake는 단순히 코드를 컴파일하는 도구를 넘어, 전체 빌드 프로세스를 조율하고 자동화하는 강력한 오케스트레이션 도구입니다.

## 1.2 역사와 목표 (History and Goals)

BitBake는 Gentoo Linux의 패키지 관리 시스템인 Portage에서 영감을 받아 개발되었습니다. 초기부터 다음과 같은 목표를 가지고 설계되었습니다.

- **범용 태스크 실행**: 특정 언어나 빌드 시스템에 종속되지 않고, 셸 스크립트나 Python 코드로 작성된 모든 종류의 태스크를 실행할 수 있습니다.
- **복잡한 의존성 처리**: 소프트웨어 간의 복잡한 빌드 및 런타임 의존성을 정확하게 처리합니다.
- **크로스 컴파일 지원**: 호스트 시스템과 다른 아키텍처를 가진 타겟 시스템용 소프트웨어를 빌드하는 크로스 컴파일 환경을 완벽하게 지원합니다.
- **다중 설정 빌드**: 동일한 소스 코드를 타겟용, 빌드 호스트용(native), SDK용 등 여러 다른 설정으로 동시에 빌드할 수 있습니다.
- **재사용성과 모듈성**: 클래스(Class)와 레이어(Layer) 개념을 통해 코드와 설정의 재사용성을 극대화하고, 프로젝트를 모듈 단위로 관리할 수 있도록 합니다.

## 1.3 개념 (Concepts)

BitBake는 여러 핵심 개념을 바탕으로 동작합니다.

### 1.3.1 레시피 (Recipes)

- 레시피(`.bb` 파일)는 BitBake의 가장 기본적인 작업 단위입니다.
- 하나의 소프트웨어 컴포넌트(예: `busybox`, `zlib`)를 가져오고, 빌드하고, 패키징하는 방법에 대한 모든 정보를 담고 있습니다.
- 주요 변수와 메타데이터:
  - `DESCRIPTION`, `LICENSE`: 패키지의 기본 정보.
  - `SRC_URI`: 소스 코드의 위치를 지정합니다. (HTTP/FTP URL, Git/SVN 저장소, 로컬 파일 등). 적용할 패치 파일(`.patch`)도 이 변수를 통해 지정합니다.
  - `DEPENDS`: 빌드 시점에 필요한 다른 레시피들을 지정합니다. (e.g., `zlib`을 빌드하기 위해 `make`가 필요한 경우)
  - `RDEPENDS`: 타겟에서 실행될 때 필요한 다른 패키지들을 지정합니다.
- `do_fetch`, `do_unpack`, `do_patch`, `do_configure`, `do_compile`, `do_install` 등 표준화된 태스크들로 구성됩니다.

### 1.3.2 설정 파일 (Configuration Files)

- 설정 파일(`.conf` 파일)은 빌드 환경 전체에 영향을 미치는 전역 변수와 설정을 정의합니다.
- **`build/conf/local.conf`**: 사용자가 직접 수정하는 주된 설정 파일입니다. 타겟 머신(`MACHINE`), 빌드 병렬 처리 수준(`BB_NUMBER_THREADS`), 다운로드 디렉터리(`DL_DIR`) 등을 설정합니다.
- **`build/conf/bblayers.conf`**: 빌드에 참여시킬 레이어들의 목록을 정의합니다.
- **`meta-*/conf/distro/*.conf`**: 배포판(Distro)의 정책을 정의합니다. (e.g., `poky.conf`)
- **`meta-*/conf/machine/*.conf`**: 타겟 하드웨어(Machine)에 특화된 설정을 정의합니다. (e.g., `qemux86-64.conf`)

### 1.3.3 클래스 (Classes)

- 클래스(`.bbclass` 파일)는 여러 레시피에서 공통으로 사용될 로직과 기능을 캡슐화한 파일입니다.
- 레시피는 `inherit` 키워드를 통해 클래스를 상속받아 기능을 쉽게 재사용할 수 있습니다.
- 예시:
  - `autotools.bbclass`: `./configure`, `make`, `make install` 과정을 자동화합니다.
  - `cmake.bbclass`: CMake 기반 프로젝트의 빌드를 지원합니다.
  - `kernel.bbclass`: Linux 커널 빌드에 필요한 복잡한 로직을 제공합니다.
  - `license.bbclass`: 라이선스 파일들을 처리하고 매니페스트를 생성합니다.

### 1.3.4 레이어 (Layers)

- 레이어는 관련된 메타데이터(레시피, 클래스, 설정 파일 등)를 그룹화하는 디렉터리 구조입니다.
- Yocto Project의 강력한 모듈성과 확장성의 핵심 요소로, 기능별, 하드웨어별로 메타데이터를 분리하여 관리할 수 있게 해줍니다.
- 예시:
  - `meta-openembedded`: 핵심 Poky에 포함되지 않은 수많은 추가 패키지 제공.
  - `meta-qt5`: Qt5 프레임워크와 관련 애플리케이션 레시피 제공.
  - `meta-raspberrypi`: 라즈베리파이 보드 지원 패키지(BSP) 관련 메타데이터 제공.

### 1.3.5 추가 파일 (Append Files)

- 추가 파일(`.bbappend` 파일)은 기존 레시피(`.bb`)를 직접 수정하지 않고, 그 내용을 덧붙이거나 덮어쓸 수 있게 해주는 강력한 기능입니다.
- 원본 레시피와 파일명이 같아야 하며(버전 포함), 다른 레이어에 위치하여 원본을 보완합니다.
- BSP 레이어에서 특정 하드웨어를 위한 커널 패치를 추가하거나, 기존 레시피의 설정을 변경하는 등 커스터마이징에 매우 유용하게 사용됩니다.

## 1.4 BitBake 구하기 (Obtaining BitBake)

BitBake는 독립적인 프로젝트이지만, 일반적으로 Yocto Project의 Poky 저장소를 통해 함께 배포됩니다.

1. Poky 저장소를 클론합니다.

   ```bash
   git clone git://git.yoctoproject.org/poky
   ```

2. oe-init-build-env 스크립트를 실행하여 빌드 환경을 설정하면, BitBake를 포함한 모든 빌드 도구를 사용할 수 있는 환경이 구성됩니다.

## 1.5 BitBake 명령어 (The BitBake Command)

### 1.5.1 사용법 및 구문 (Usage and syntax)

주요 옵션:

- -c <task>: 특정 태스크를 실행합니다. (e.g., clean, compile, deploy)
- -k, --continue: 특정 레시피 빌드에 실패하더라도, 의존성이 없는 다른 레시피들의 빌드를 계속 진행합니다.
- -e, --environment: 특정 레시피의 빌드 환경 변수 전체를 출력합니다. 디버깅에 매우 유용합니다.
- -g, --graphviz: 레시피의 태스크 의존성 관계를 task-depends.dot 파일로 생성합니다.
- -s, --show-recipes: 빌드 가능한 모든 레시피와 그 버전을 보여줍니다.

### 1.5.2 예시 (Examples)

- 단일 레시피 빌드

```bash
# busybox 패키지를 빌드
bitbake busybox
```

- 특정 태스크 실행

```bash
# busybox 레시피의 컴파일만 실행
bitbake -c compile busybox

# busybox 레시피의 모든 임시 파일과 sstate 캐시 삭제
bitbake -c cleanall busybox
```

- 이미지 빌드

```bash
# 최소한의 부팅 가능한 콘솔 이미지 빌드
bitbake core-image-minimal
```

- 의존성 그래프 생성

```bash
# core-image-minimal 이미지의 태스크 의존성 그래프 생성
bitbake -g core-image-minimal
```

