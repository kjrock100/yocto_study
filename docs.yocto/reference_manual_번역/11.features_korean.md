# 기능(Features)

이 장에서는 이미지의 일부로 포함할 수 있는 제공되는 머신 및 배포 기능에 대한 참조, 선택할 수 있는 이미지 기능에 대한 참조, 그리고 Feature Backfilling에 대한 참조를 제공합니다.

기능(Features)은 생성된 이미지에 포함되어야 할 패키지를 결정하기 위한 메커니즘을 제공합니다. 배포판은 DISTRO_FEATURES 변수를 통해 지원할 기능을 선택할 수 있으며, 이는 `poky.conf`, `poky-tiny.conf`, `poky-altcfg.conf` 등과 같은 배포판의 구성 파일에 설정 또는 추가됩니다. 머신 기능은 MACHINE_FEATURES 변수에 설정되며, 이는 머신 구성 파일에 설정되고 주어진 머신의 하드웨어 기능을 지정합니다.

이 두 변수는 함께 작동하여 포함할 커널 모듈, 유틸리티 및 기타 패키지를 결정합니다. 주어진 배포판은 선택한 기능의 하위 집합을 지원할 수 있으므로 배포판 자체가 지원하지 않으면 일부 머신 기능이 포함되지 않을 수 있습니다.

특정 기능이 포함되어 있는지 확인하는 레시피를 결정하는 데 사용할 수 있는 한 가지 방법은 메타데이터에서 기능을 grep하는 것입니다. 다음은 주어진 기능을 기반으로 빌드가 변경될 수 있는 레시피를 찾는 예입니다:

```bash
$ cd poky
$ git grep 'contains.*MACHINE_FEATURES.*feature'
```

## 11.1 머신 기능(Machine Features)

아래 항목은 MACHINE_FEATURES와 함께 사용할 수 있는 기능입니다. 기능은 패키지에 일대일 대응하지 않으며, 단순히 패키지 또는 패키지의 설치를 제어하는 것 이상을 수행할 수 있습니다. 때때로 기능은 특정 레시피가 빌드되는 방식에 영향을 미칠 수 있습니다. 예를 들어, 기능은 특정 레시피의 do_configure 작업 내에서 특정 구성 옵션이 지정되는지 여부를 결정할 수 있습니다.

이 기능 목록은 Yocto Project 메타데이터와 함께 제공되는 기능만 나타냅니다:

- **acpi**: 하드웨어에 ACPI가 있음 (x86/x86_64만 해당)
- **alsa**: 하드웨어에 ALSA 오디오 드라이버가 있음
- **bluetooth**: 하드웨어에 내장 BT가 있음
- **efi**: EFI를 통한 부팅 지원
- **ext2**: 하드웨어 HDD 또는 마이크로드라이브
- **keyboard**: 하드웨어에 키보드가 있음
- **lima**: 하드웨어에 LIMA GPU가 있음
- **m2m**: 하드웨어에 다중 미디어 변환 가속기가 있음
- **mmu**: 하드웨어에 메모리 관리 장치가 있음
- **neon**: 하드웨어에 ARM NEON 미디어 가속이 있음
- **numa**: 하드웨어에 비균일 메모리 액세스가 있음
- **pcbios**: BIOS를 통한 부팅 지원
- **pci**: 하드웨어에 PCI 버스가 있음
- **pcmcia**: 하드웨어에 PCMCIA 또는 CompactFlash 소켓이 있음
- **phone**: 모바일 폰 (음성) 지원
- **qemu-usermode**: QEMU은 이 머신에 대해 사용자 모드 에뮬레이션을 지원할 수 있음
- **qvga**: 머신에 QVGA (320x240) 디스플레이가 있음
- **rtc**: 머신에 실시간 시계(RTC)가 있음
- **screen**: 하드웨어에 화면이 있음
- **serial**: 하드웨어에 시리얼 지원이 있음 (일반적으로 RS232)
- **touchscreen**: 하드웨어에 터치스크린이 있음
- **usbgadget**: 하드웨어는 USB 가젯 디바이스 지원 가능
- **usbhost**: 하드웨어는 USB Host 지원 가능
- **vfat**: FAT 파일 시스템 지원
- **wifi**: 하드웨어에 내장 WiFi가 있음

## 11.2 배포 기능(Distro Features)

아래 항목은 DISTRO_FEATURES와 함께 사용하여 배포판 전체에서 기능을 활성화할 수 있는 기능입니다. 기능은 패키지에 일대일 대응하지 않으며, 단순히 패키지 또는 패키지의 설치를 제어하는 것 이상을 수행할 수 있습니다. 대부분의 경우 기능의 존재 또는 부재는 선택적으로 기능을 지원하는 레시피에 대한 do_configure 작업 중에 구성 스크립트에 제공되는 적절한 옵션으로 변환됩니다. 적절한 옵션을 제공해야 하며, 관련 패키지에 대한 PACKAGECONFIG를 활성화/비활성화하는 것은 그러한 옵션을 제공하는 한 가지 방법입니다.

일부 배포판 기능도 머신 기능입니다. 이러한 선택 기능은 머신 및 배포판 구성 수준 모두에서 제어하는 것이 합리적입니다. 자세한 정보는 COMBINED_FEATURES 변수를 참조하세요.

> **참고:** DISTRO_FEATURES는 일반적으로 커널 구성과 독립적이므로 DISTRO_FEATURES에서 지정된 기능이 커널의 지원에도 의존하는 경우 커널 구성에서도 지원이 활성화되어 있는지 확인해야 합니다.

이 목록은 Yocto Project 메타데이터와 함께 제공되는 기능만 나타내며, 추가 레이어는 자신의 기능을 정의할 수 있습니다:

- **3g**: 셀룰러 데이터에 대한 지원 포함
- **acl**: Access Control List 지원 포함
- **alsa**: Advanced Linux Sound Architecture 지원 포함 (사용 가능한 경우 OSS 호환 커널 모듈 설치)
- **api-documentation**: 레시피 빌드 중 API 문서 생성을 활성화합니다. 결과 문서는 `bitbake -c populate_sdk` 명령을 사용할 때 SDK 타르볼에 추가됩니다.
- **bluetooth**: 블루투스 지원 포함 (내장 BT만)
- **cramfs**: CramFS 지원 포함
- **debuginfod**: debuginfod 서버를 통해 ELF 디버깅 정보를 가져오기 위한 지원 포함
- **directfb**: DirectFB 지원 포함
- **ext2**: 파일 저장을 위해 내부 HDD/마이크로드라이브가 있는 디바이스를 지원하기 위한 도구 포함 (Flash만 있는 디바이스 대신)
- **gobject-introspection-data**: GObject Introspection을 지원하기 위한 데이터 포함
- **ipsec**: IPSec 지원 포함
- **ipv4**: IPv4 지원 포함
- **ipv6**: IPv6 지원 포함
- **keyboard**: 키보드 지원 포함 (예: 부팅 중 키맵이 로드됨)
- **minidebuginfo**: 최소 디버그 심볼을 바이너리 파일에 추가하여 `coredumpctl` 및 `gdb`가 심볼화된 스택 추적을 표시할 수 있도록 합니다.
- **multiarch**: 다중 아키텍처 지원으로 응용 프로그램 빌드를 활성화합니다.
- **ldconfig**: 타겟에서 ldconfig 및 `ld.so.conf` 지원 포함
- **lto**: Link-Time Optimisation 활성화
- **nfc**: Near Field Communication 지원 포함
- **nfs**: NFS 클라이언트 지원 포함 (디바이스에서 NFS 내보내기 마운트)
- **nls**: National Language Support (NLS) 포함
- **opengl**: 2D 및 3D 그래픽을 렌더링하는 데 사용되는 교차 언어, 다중 플랫폼 응용 프로그래밍 인터페이스인 Open Graphics Library 포함
- **overlayfs**: OverlayFS 지원 포함
- **pam**: Pluggable Authentication Module (PAM) 지원 포함
- **pci**: PCI 버스 지원 포함
- **pcmcia**: PCMCIA/CompactFlash 지원 포함
- **pni-names**: 지속적인 네트워크 인터페이스 이름 생성을 활성화합니다. 즉, 시스템은 재설치 후에도 네트워크 인터페이스에 대해 동일하지만 고유한 이름을 갖도록 노력합니다.
- **polkit**: Polkit 지원 포함
- **ppp**: PPP 전화 걸기 지원 포함
- **ptest**: 개별 레시피에서 지원하는 패키지 테스트 빌드를 활성화합니다. 패키지 테스트에 대한 자세한 정보는 Yocto Project 개발 작업 설명서의 "Testing Packages With ptest" 섹션을 참조하세요.
- **pulseaudio**: PulseAudio 지원 포함
- **selinux**: Security-Enhanced Linux (SELinux) 지원 포함 (meta-selinux 필요)
- **seccomp**: seccomp 지원으로 응용 프로그램 빌드를 활성화하여 호출할 수 있는 시스템 호출을 엄격하게 제한하도록 합니다.
- **smbfs**: SMB 네트워크 클라이언트 지원 포함 (디바이스에서 Samba/Microsoft Windows 공유 마운트)
- **systemd**: 이 `init` 관리자에 대한 지원을 포함하며, 이는 서비스의 병렬 시작, 감소된 쉘 오버헤드 및 기타 기능을 갖는 `init`의 완전한 대체입니다. 이 `init` 관리자는 많은 배포판에서 사용합니다.
- **systemd-resolved**: `glibc` Name Service Switch에서 `systemd-resolved`를 지원 및 사용 포함. 이것은 `systemd`의 DNS 리졸버 데몬입니다.
- **usbgadget**: USB Gadget Device 지원 포함 (USB 네트워킹/시리얼/저장소용)
- **usbhost**: USB Host 지원 포함 (외부 키보드, 마우스, 저장소, 네트워크 등을 연결할 수 있음)
- **usrmerge**: `/bin`, `/sbin`, `/lib` 및 `/lib64` 디렉토리를 `/usr` 디렉토리의 각 해당 항목으로 병합하여 더 나은 패키지 및 응용 프로그램 호환성을 제공합니다.
- **vfat**: FAT 파일시스템 지원 포함
- **vulkan**: Vulkan API 지원 포함
- **wayland**: Wayland 디스플레이 서버 프로토콜 및 이를 지원하는 라이브러리 포함
- **wifi**: WiFi 지원 포함 (내장만)
- **x11**: X 서버 및 라이브러리 포함
- **xattr**: 확장 파일 속성 지원 포함
- **zeroconf**: 영 설정 네트워킹 지원 포함

## 11.3 이미지 기능(Image Features)

OpenEmbedded 빌드 시스템에서 생성된 이미지의 내용은 일반적으로 이미지 레시피에서 구성하는 IMAGE_FEATURES 및 EXTRA_IMAGE_FEATURES 변수로 제어할 수 있습니다. 이러한 변수를 통해 개발 유틸리티 또는 응용 프로그램 문제를 조사하거나 응용 프로그램을 프로파일링하는 데 필요한 디버그 정보가 있는 패키지와 같은 여러 다른 미리 정의된 패키지를 추가할 수 있습니다.

모든 이미지에 사용 가능한 이미지 기능:

- **allow-empty-password**: Dropbear 및 OpenSSH가 빈 암호 문자열이 있는 계정에서의 로그인을 허용합니다.
- **allow-root-login**: Dropbear 및 OpenSSH가 루트 로그인을 허용합니다.
- **dbg-pkgs**: 주어진 이미지에 설치된 모든 패키지에 대한 디버그 심볼 패키지를 설치합니다.
- **dev-pkgs**: 주어진 이미지에 설치된 모든 패키지에 대한 개발 패키지(헤더 및 추가 라이브러리 링크)를 설치합니다.
- **doc-pkgs**: 주어진 이미지에 설치된 모든 패키지에 대한 문서 패키지를 설치합니다.
- **empty-root-password**: 빈 암호로 루트 로그인을 허용하려는 경우 이 기능을 사용할 수 있습니다. 이 기능이 IMAGE_FEATURES에 없으면 `/etc/passwd` 및 `/etc/shadow`가 존재하는 경우 비어 있지 않은 암호가 강제됩니다.

> **참고:** `empty-root-password`는 자체적으로 빈 루트 암호를 설정하지 않습니다. base-passwd 및 shadow 레시피 덕분에 초기 빈 루트 암호를 얻으며, `empty-root-password`의 존재는 루트 사용자에게 비어 있지 않은 암호를 강제하는 메커니즘을 비활성화할 뿐입니다.

- **lic-pkgs**: 주어진 이미지에 설치된 모든 패키지에 대한 라이선스 패키지를 설치합니다.
- **overlayfs-etc**: `/etc` 디렉토리를 `overlayfs`로 구성합니다. 이를 통해 디바이스별 정보를 다른 곳에 저장할 수 있으며, 특히 루트 파일시스템이 읽기 전용으로 구성된 경우입니다.
- **package-management**: 패키지 관리 도구를 설치하고 패키지 관리자 데이터베이스를 유지합니다.
- **post-install-logging**: 타겟 시스템에서 이미지의 첫 부팅 시 `/var/log/postinstall.log` 파일에 postinstall 스크립트 실행 로깅을 활성화합니다.

> **참고:** 타겟의 `/var/log` 디렉토리를 영구적으로 만들려면 FILESYSTEM_PERMS_TABLES에서 `files/fs-perms-volatile-log.txt` 값을 제거합니다.

- **ptest-pkgs**: 모든 ptest 활성화 레시피에 대한 ptest 패키지를 설치합니다.
- **read-only-rootfs**: 루트 파일시스템이 읽기 전용인 이미지를 생성합니다. Yocto Project 개발 작업 설명서의 "Creating a Read-Only Root Filesystem" 섹션을 참조하세요.
- **read-only-rootfs-delayed-postinsts**: `read-only-rootfs`와 함께 지정되면 post-install 스크립트가 여전히 허용됨을 지정합니다 (루트 파일시스템이 첫 부팅에서 쓰기 가능하도록 만들어질 것으로 가정; 이 기능은 그렇게 하기 위해 아무것도 하지 않으며, post-install 스크립트 검사를 비활성화할 뿐입니다).
- **serial-autologin-root**: `empty-root-password`와 함께 지정되면 시리얼 콘솔에서 자동으로 루트로 로그인합니다. 물론 시리얼 콘솔이 공격자에게 접근 가능하면 보안 허점이 열리므로 주의해서 사용하세요.
- **splash**: 부팅 중에 스플래시 화면을 표시하도록 활성화합니다. 기본적으로 이 화면은 `psplash`에서 제공하며, 이는 사용자 정의를 허용합니다. 대체 스플래시 화면 패키지를 사용하려면 이미지 레시피 또는 배포판 구성 수준에서 SPLASH 변수를 다른 패키지 이름으로 설정할 수 있습니다.
- **stateless-rootfs**: 이미지를 stateless로 생성해야 함을 지정합니다. `systemd`를 사용할 때 `systemctl-native`는 이미지에서 실행되지 않으므로 systemd에 의해 런타임에 채워지도록 이미지를 남깁니다.
- **staticdev-pkgs**: 주어진 이미지에 설치된 모든 패키지에 대한 정적 개발 패키지(정적 라이브러리, 즉 `*.a` 파일)를 설치합니다.

일부 이미지 기능은 core-image 클래스를 상속할 때만 사용 가능합니다. 현재 이 유효한 기능 목록은 다음과 같습니다:

- **hwcodecs**: 하드웨어 가속 코덱을 설치합니다.
- **nfs-server**: NFS 서버를 설치합니다.
- **perf**: `perf`, `systemtap`, `LTTng`과 같은 프로파일링 도구를 설치합니다. 사용자 공간 도구에 대한 일반 정보는 Yocto Project Application Development and the Extensible Software Development Kit (eSDK) 설명서를 참조하세요.
- **ssh-server-dropbear**: Dropbear 최소 SSH 서버를 설치합니다.

> **참고:** 4.1 릴리스 현재 `ssh-server-dropbear` 기능은 또한 `openssh-sftp-server` 패키지를 권장하며, 기본적으로 이미지로 가져와집니다. 이는 최근 버전의 OpenSSH `scp` 클라이언트가 이제 SFTP 프로토콜을 사용하기 때문이며 연결하기 위해 SFTP 서버가 있어야 합니다. 그러나 SFTP 서버가 설치되지 않은 Dropbear ssh 서버를 사용하려면 IMAGE_FEATURES에서 `ssh-server-dropbear`를 제거하고 대신 IMAGE_INSTALL에 `dropbear`를 추가하거나, 또는 기능을 계속 사용하되 BAD_RECOMMENDATIONS을 다음과 같이 설정할 수 있습니다:
>
> ```
> BAD_RECOMMENDATIONS += "openssh-sftp-server"
> ```

- **ssh-server-openssh**: Dropbear보다 더 완전한 OpenSSH SSH 서버를 설치합니다. OpenSSH SSH 서버와 Dropbear 최소 SSH 서버가 모두 IMAGE_FEATURES에 있으면 OpenSSH가 우선순위를 가지며 Dropbear는 설치되지 않습니다.
- **tools-debug**: `strace` 및 `gdb`과 같은 디버깅 도구를 설치합니다. GDB에 대한 정보는 Yocto Project 개발 작업 설명서의 "Debugging With the GNU Project Debugger (GDB) Remotely" 섹션을 참조하세요. 추적 및 프로파일링에 대한 정보는 Yocto Project Profiling and Tracing Manual을 참조하세요.
- **tools-sdk**: 디바이스에서 실행되는 전체 SDK를 설치합니다.
- **tools-testapps**: 디바이스 테스팅 도구 (예: 터치스크린 디버깅)를 설치합니다.
- **weston**: Weston (참조 Wayland 환경)을 설치합니다.
- **x11**: X 서버를 설치합니다.
- **x11-base**: 최소 환경으로 X 서버를 설치합니다.
- **x11-sato**: OpenedHand Sato 환경을 설치합니다.

## 11.4 Feature Backfilling

때때로 OpenEmbedded 빌드 시스템에서는 MACHINE_FEATURES 또는 DISTRO_FEATURES에 새로운 기능을 추가해야 하지만, 동시에 기존 배포판 또는 머신 정의가 그러한 새로운 기능을 거부하여 동일한 전체 기능 수준을 유지할 수 있도록 해야 합니다.

이를 가능하게 하기 위해 OpenEmbedded 빌드 시스템에는 기존 배포판 또는 머신 구성에 기능을 자동으로 "backfill"하는 메커니즘이 있습니다. `meta/conf/bitbake.conf` 파일의 DISTRO_FEATURES_BACKFILL 및 MACHINE_FEATURES_BACKFILL 변수를 확인하여 이에 대해 수행되는 기능 목록을 볼 수 있습니다.

이 두 변수는 DISTRO_FEATURES_BACKFILL_CONSIDERED 및 MACHINE_FEATURES_BACKFILL_CONSIDERED 변수와 쌍을 이루며, 이는 배포판 또는 머신 구성 유지관리자가 추가된 기능을 고려하고 그러한 기능을 유지하거나 제외할 때를 결정할 수 있도록 하여 backfill이 발생하는 것을 방지합니다.

다음은 feature backfilling을 설명하는 두 가지 예입니다:

### "pulseaudio" Distro Feature 옵션

이전에 PulseAudio 지원은 Qt 및 GStreamer 프레임워크 내에서 활성화되었습니다. 이 때문에 기능은 이제 backfill되며 따라서 `meta/conf/bitbake.conf` 파일의 DISTRO_FEATURES_BACKFILL 변수를 통해 모든 배포판에 대해 활성화됩니다. 그러나 배포판이 기능을 비활성화해야 하는 경우 PulseAudio 지원이 필요한 다른 기존 배포판 구성에 영향을 주지 않고 그렇게 할 수 있습니다.

배포판의 `.conf` 파일의 DISTRO_FEATURES_BACKFILL_CONSIDERED에 "pulseaudio"를 추가하여 이를 수행합니다. 따라서 DISTRO_FEATURES_BACKFILL에도 있는 변수에 기능을 추가하면 빌드 시스템이 구성의 DISTRO_FEATURES에 기능을 추가하는 것을 방지하여 특정 배포판에 대한 기능을 효과적으로 비활성화합니다.

### "rtc" Machine Feature 옵션

이전에 실시간 시계(RTC) 지원은 모든 타겟 디바이스에 대해 활성화되었습니다. 이 때문에 기능은 backfill되며 따라서 `meta/conf/bitbake.conf` 파일의 MACHINE_FEATURES_BACKFILL 변수를 통해 모든 머신에 대해 활성화됩니다. 그러나 타겟 디바이스에 이 기능이 없는 경우 RTC 지원이 필요한 다른 머신에 영향을 주지 않고 디바이스의 RTC 지원을 비활성화할 수 있습니다.

머신의 `.conf` 파일의 MACHINE_FEATURES_BACKFILL_CONSIDERED 목록에 "rtc" 기능을 추가하여 이를 수행합니다. 따라서 MACHINE_FEATURES_BACKFILL에도 있는 변수에 기능을 추가하면 빌드 시스템이 구성의 MACHINE_FEATURES에 기능을 추가하는 것을 방지하여 특정 머신에 대한 RTC 지원을 효과적으로 비활성화합니다.
