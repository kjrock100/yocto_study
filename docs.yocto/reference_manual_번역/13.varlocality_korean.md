# 13. 변수 컨텍스트 (Variable Context)

변수 컨텍스트는 Yocto 프로젝트에서 변수가 사용되는 위치와 범위를 정의합니다. 대부분의 변수는 `.conf`, `.bbclass`, `.inc`, `.bb` 파일 등 거의 모든 컨텍스트에서 사용할 수 있지만, 일부 변수는 특정한 로컬리티(지역)나 컨텍스트와 관련이 있습니다. 이 장에서는 일반적인 변수와 컨텍스트의 연관성을 설명합니다.

## 13.1 설정 (Configuration)

다음 섹션에서는 컨텍스트가 설정인 변수들의 목록을 제공합니다: 배포(Distribution), 머신(Machine), 로컬(Local) 설정입니다.

### 13.1.1 배포 (Distro) 설정

이 섹션에서는 배포(배포판) 설정 컨텍스트인 변수들을 나열합니다.

#### 배포 관련 변수

- **DISTRO**: 빌드에 사용할 배포판을 지정하는 변수입니다. 배포판은 특정 패키지 조합, 설정, 기능을 정의합니다.

- **DISTRO_NAME**: 배포판의 사람이 읽을 수 있는 이름을 설정합니다.

- **DISTRO_VERSION**: 배포판의 버전을 나타냅니다.

- **MAINTAINER**: 배포판의 유지보수자를 지정합니다.

- **PACKAGE_CLASSES**: 사용할 패키지 형식을 정의합니다 (예: `package_rpm`, `package_deb`, `package_ipk`).

- **TARGET_OS**: 대상 시스템의 운영 체제를 지정합니다 (예: `linux`, `linux-musl`).

- **TARGET_FPU**: 대상 시스템의 부동소수점 단위(FPU) 유형을 지정합니다 (예: `hard`, `soft`).

- **TCMODE**: 툴체인 모드를 설정합니다. 기본값은 "default"입니다.

- **TCLIBC**: 대상 시스템에서 사용할 C 라이브러리를 지정합니다 (예: `glibc`, `musl`, `uclibc`).

### 13.1.2 머신 (Machine) 설정

이 섹션에서는 머신 설정 컨텍스트인 변수들을 나열합니다.

#### 머신 관련 변수

- **TARGET_ARCH**: 대상 시스템의 아키텍처를 지정합니다 (예: `x86_64`, `arm`, `mips`).

- **SERIAL_CONSOLES**: 직렬 콘솔의 포트와 보드레이트를 정의합니다. 타겟 시스템에서 콘솔 액세스에 사용됩니다.

- **PACKAGE_EXTRA_ARCHS**: 추가 패키지 아키텍처를 지정합니다. 다중라이브(Multilib) 빌드를 위해 사용됩니다.

- **IMAGE_FSTYPES**: 생성할 이미지의 파일 시스템 유형을 정의합니다 (예: `ext4`, `tar.gz`, `wic`).

- **MACHINE_FEATURES**: 머신이 지원하는 기능들을 정의합니다 (예: `wifi`, `bluetooth`, `qemu-usermode`).

- **MACHINE_EXTRA_RDEPENDS**: 머신에 필요한 추가 런타임 의존성을 지정합니다.

- **MACHINE_EXTRA_RRECOMMENDS**: 머신에 권장되는 추가 런타임 패키지들을 지정합니다.

- **MACHINE_ESSENTIAL_EXTRA_RDEPENDS**: 머신의 필수 추가 런타임 의존성을 지정합니다.

- **MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS**: 머신의 필수 추가 권장 런타임 패키지들을 지정합니다.

### 13.1.3 로컬 (Local) 설정

이 섹션에서는 `local.conf` 파일을 통한 로컬 설정 컨텍스트인 변수들을 나열합니다.

#### 로컬 설정 변수

- **DISTRO**: 사용할 배포판을 지정합니다. 이는 로컬 설정에서 선택할 수 있습니다.

- **MACHINE**: 빌드 대상 머신을 지정합니다 (예: `qemux86-64`, `raspberrypi4`, `beaglebone`).

- **DL_DIR**: 다운로드된 소스 코드와 패치가 저장되는 디렉토리를 지정합니다. 기본값은 `${TOPDIR}/downloads`입니다.

- **BBFILES**: BitBake가 찾을 레시피 파일의 경로 패턴을 정의합니다.

- **EXTRA_IMAGE_FEATURES**: 이미지에 추가할 옵션 기능들을 지정합니다 (예: `debug-tweaks`, `tools-debug`).

- **PACKAGE_CLASSES**: 빌드에 사용할 패키지 형식을 지정합니다.

- **BB_NUMBER_THREADS**: BitBake가 병렬로 실행할 작업의 수를 설정합니다.

- **BBINCLUDELOGS**: 빌드 실패 시 로그 파일을 포함할지 여부를 제어합니다.

- **ENABLE_BINARY_LOCALE_GENERATION**: 바이너리 로케일 생성 활성화 여부를 제어합니다.

## 13.2 레시피 (Recipes)

다음 섹션에서는 컨텍스트가 레시피인 변수들의 목록을 제공합니다: 필수, 의존성, 경로, 추가 빌드 정보.

### 13.2.1 필수 (Required) 변수

이 섹션에서는 레시피에 필수적인 변수들을 나열합니다.

#### 필수 레시피 변수

- **LICENSE**: 레시피가 빌드하는 소프트웨어의 라이선스를 지정합니다 (예: `MIT`, `GPL-2.0-only`, `Apache-2.0`). 라이선스 준수를 위해 필수입니다.

- **LIC_FILES_CHKSUM**: 라이선스 파일의 체크섬을 지정하여 라이선스 파일 변경을 감지합니다. 형식: `LIC_FILES_CHKSUM = "file://LICENSE;md5=abc123..."`

- **SRC_URI**: 소스 코드를 다운로드할 URL을 지정합니다. 로컬 파일이나 원격 URL에서 가져올 수 있습니다.

### 13.2.2 의존성 (Dependencies) 변수

이 섹션에서는 레시피 의존성을 정의하는 변수들을 나열합니다.

#### 의존성 변수

- **DEPENDS**: 빌드 시간에 필요한 의존성을 지정합니다. 컴파일에 필요한 라이브러리, 헤더 파일, 도구들입니다.

  - 예: `DEPENDS = "openssl zlib"`

- **RDEPENDS**: 런타임에 필요한 의존성을 지정합니다. 생성된 패키지가 실행될 때 필요한 라이브러리나 패키지입니다.

  - 예: `RDEPENDS:${PN} = "libc6 libssl1.1"`

- **RRECOMMENDS**: 권장되는 런타임 의존성을 지정합니다. 필수는 아니지만 권장되는 패키지들입니다.

  - 예: `RRECOMMENDS:${PN} = "additional-tools"`

- **RCONFLICTS**: 런타임 충돌을 정의합니다. 이 패키지와 동시에 설치될 수 없는 패키지들을 명시합니다.

- **RREPLACES**: 이 패키지가 다른 패키지를 대체할 수 있음을 지정합니다.

### 13.2.3 경로 (Paths) 변수

이 섹션에서는 레시피 경로를 정의하는 변수들을 나열합니다.

#### 경로 관련 변수

- **WORKDIR**: 레시피의 작업 디렉토리입니다. 소스 코드의 압축을 풀고 빌드가 수행되는 위치입니다.

  - 기본값: `${TMPDIR}/work/${MULTIMACH_TARGET_SYS}/${PN}-${PV}`

- **S**: 소스 코드 디렉토리입니다. `do_configure`, `do_compile` 등의 작업이 이 디렉토리에서 수행됩니다.

  - 기본값: `${WORKDIR}/${BP}` (여기서 BP는 Base Path)

- **FILES**: 패키지에 포함될 파일을 지정합니다. 각 패키지에 대해 어떤 파일을 포함할지를 정의합니다.
  - 예: `FILES:${PN} = "${bindir}/* ${sysconfdir}/*"`

### 13.2.4 추가 빌드 정보 (Extra Build Information) 변수

이 섹션에서는 레시피에 대한 추가 빌드 정보를 정의하는 변수들을 나열합니다.

#### 추가 빌드 정보 변수

- **DEFAULT_PREFERENCE**: 같은 이름의 여러 버전의 레시피 중 선택할 기본 버전을 지정합니다. 더 높은 값일수록 우선순위가 높습니다.

- **EXTRA_OECMAKE**: CMake 빌드 시 추가 옵션을 지정합니다.

  - 예: `EXTRA_OECMAKE = "-DENABLE_SHARED_LIBS=ON"`

- **EXTRA_OECONF**: Autotools 기반 빌드에서 `configure` 스크립트에 전달할 추가 옵션을 지정합니다.

  - 예: `EXTRA_OECONF = "--enable-feature --disable-other"`

- **EXTRA_OEMAKE**: `make` 명령에 전달할 추가 옵션을 지정합니다.

  - 예: `EXTRA_OEMAKE = "VERBOSE=1"`

- **PACKAGECONFIG_CONFARGS**: `PACKAGECONFIG`와 관련된 추가 설정 인수를 정의합니다.

- **PACKAGES**: 레시피에서 생성할 패키지들을 정의합니다. 순서가 중요하며, 먼저 나열된 패키지가 우선순위를 가집니다.
  - 예: `PACKAGES = "${PN}-dev ${PN}-doc ${PN}"`

## 변수 컨텍스트 요약

### 설정 (Configuration) 컨텍스트

- **배포 수준**: 전체 배포판에 영향을 미치는 변수들 (DISTRO, TCLIBC, PACKAGE_CLASSES 등)
- **머신 수준**: 특정 머신에만 영향을 미치는 변수들 (TARGET_ARCH, MACHINE_FEATURES 등)
- **로컬 수준**: 사용자의 로컬 설정을 통해 지정되는 변수들 (MACHINE, DL_DIR, BB_NUMBER_THREADS 등)

### 레시피 (Recipe) 컨텍스트

- **필수 정보**: 레시피가 올바르게 작동하기 위해 필요한 정보 (LICENSE, SRC_URI 등)
- **의존성**: 다른 패키지나 도구에 대한 요구사항 (DEPENDS, RDEPENDS 등)
- **경로**: 소스 코드와 파일이 위치하는 디렉토리 (WORKDIR, S, FILES 등)
- **빌드 옵션**: 빌드 프로세스를 제어하는 추가 정보 (EXTRA_OECONF, EXTRA_OEMAKE 등)

이러한 변수 컨텍스트를 이해하는 것은 Yocto Project 메타데이터를 효과적으로 작성하고 유지보수하는 데 매우 중요합니다.
