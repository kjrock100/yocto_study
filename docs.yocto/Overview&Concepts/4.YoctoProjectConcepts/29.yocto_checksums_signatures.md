# Yocto Project 체크섬 (Checksums / Signatures)

Yocto Project의 빌드 시스템인 BitBake는 **체크섬(Checksums)** 또는 **서명(Signatures)**이라고 불리는 메커니즘을 사용하여 태스크의 상태를 추적하고 관리합니다. 이는 공유 상태 캐시(Shared State Cache)가 올바르게 작동하기 위한 핵심 기술입니다.

## 1. 개요

BitBake는 태스크를 실행하기 전에 해당 태스크의 입력값들을 기반으로 고유한 해시값(Signature)을 계산합니다. 이 값이 변경되지 않았다면, 이전에 수행한 작업의 결과가 여전히 유효하다고 판단하여 재빌드를 수행하지 않고 캐시된 결과를 사용합니다.

## 2. 체크섬 계산 방식 (Calculation)

체크섬은 단순히 소스 코드 파일의 해시가 아닙니다. BitBake는 태스크의 실행에 영향을 미칠 수 있는 모든 요소를 고려하여 서명을 생성합니다.

### 주요 입력 요소
1.  **태스크 코드:** 실행될 쉘 스크립트나 파이썬 함수의 내용.
2.  **변수 값:** 태스크 내에서 참조하거나 의존하는 모든 BitBake 변수(예: `PV`, `CFLAGS`, `SRC_URI` 등)의 값.
3.  **의존성 (Dependencies):** 이 태스크가 의존하는 이전 태스크들의 체크섬. (예: `do_install`은 `do_compile`에 의존하므로, `do_compile`의 체크섬이 바뀌면 `do_install`의 체크섬도 바뀝니다.)
4.  **상속 및 설정:** 레시피가 상속받은 클래스(`.bbclass`)나 전역 설정(`.conf`)의 변경 사항.

## 3. 역할 및 중요성

### 3.1 점진적 빌드 (Incremental Builds)
체크섬 덕분에 BitBake는 변경된 부분만 정확히 찾아내어 다시 빌드할 수 있습니다. 예를 들어, 커널 설정(`defconfig`)만 바꾸면 커널 컴파일 태스크의 체크섬이 변경되어 커널은 다시 빌드되지만, 커널과 무관한 사용자 애플리케이션은 재빌드되지 않습니다.

### 3.2 공유 상태 캐시 (SState Cache)
`sstate-cache` 디렉토리에 저장되는 파일들의 이름은 이 체크섬을 포함하고 있습니다.
*   빌드 시 현재 계산된 체크섬과 일치하는 파일이 캐시에 있다면, BitBake는 "이 작업은 이미 수행되었음"으로 간주하고 **Setscene Task**를 통해 결과물만 복원합니다.

## 4. 디버깅 도구 (Debugging Tools)

가끔 아무것도 변경하지 않은 것 같은데 패키지가 다시 빌드되는 경우가 있습니다. 이때는 체크섬이 왜 변경되었는지 확인해야 합니다.

### 4.1 bitbake-diffsigs
두 개의 서명 파일(`.sigdata`)을 비교하여 어떤 변수나 의존성이 변경되었는지 보여주는 도구입니다.

```bash
# 사용 예시
bitbake-diffsigs A.do_compile.sigdata B.do_compile.sigdata
```

### 4.2 bitbake -S printdiff
특정 타겟에 대해 서명을 생성하고 변경 사항을 출력합니다.

```bash
bitbake -S printdiff core-image-minimal
```

## 5. 요약

*   **Signature:** 태스크의 입력 상태를 나타내는 고유 해시값.
*   **민감도:** 공백 하나, 변수 값 하나만 바뀌어도 체크섬은 변경됩니다.
*   **무결성:** 이를 통해 Yocto Project는 항상 신뢰할 수 있는 빌드 결과를 보장합니다.
