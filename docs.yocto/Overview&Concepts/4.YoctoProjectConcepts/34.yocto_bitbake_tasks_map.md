# Yocto Project BitBake 태스크 맵 (BitBake Tasks Map)

Yocto Project에서 패키지나 이미지를 빌드할 때, BitBake는 정해진 순서에 따라 일련의 **태스크(Tasks)**를 실행합니다. 이 태스크들의 흐름과 관계를 이해하는 것은 빌드 과정을 디버깅하거나 레시피를 작성할 때 매우 중요합니다.

## 1. 표준 태스크 흐름 (Standard Task Flow)

일반적인 소프트웨어 레시피의 빌드 과정은 다음과 같은 순서로 진행됩니다.

```mermaid
graph TD
    fetch[do_fetch] --> unpack[do_unpack]
    unpack --> patch[do_patch]
    patch --> prepare[do_prepare_recipe_sysroot]
    prepare --> configure[do_configure]
    configure --> compile[do_compile]
    compile --> install[do_install]
    install --> package[do_package]
    install --> populate[do_populate_sysroot]
    package --> packagedata[do_packagedata]
    package --> write_rpm[do_package_write_rpm/deb/ipk]
    write_rpm --> rootfs[do_rootfs (Image Recipe only)]
```

*(참고: 위 흐름은 개념적인 순서이며, 실제로는 병렬로 실행되거나 sstate-cache에 의해 건너뛰어질 수 있습니다.)*

## 2. 주요 태스크 설명

### 2.1 소스 준비 단계
*   **`do_fetch`**: `SRC_URI`에 정의된 소스 코드를 다운로드합니다 (`DL_DIR`에 저장).
*   **`do_unpack`**: 다운로드한 소스를 작업 디렉토리(`WORKDIR`)에 압축 해제합니다.
*   **`do_patch`**: `.patch` 파일들을 소스 코드에 적용합니다.

### 2.2 빌드 준비 및 컴파일 단계
*   **`do_prepare_recipe_sysroot`**: `DEPENDS`에 정의된 빌드 의존성 패키지들의 라이브러리와 헤더를 레시피 전용 Sysroot(`RECIPE_SYSROOT`)에 설치합니다.
*   **`do_configure`**: 소스 코드의 빌드 환경을 설정합니다 (예: `./configure`, `cmake`, `meson`).
*   **`do_compile`**: 소스 코드를 컴파일하고 링크합니다 (예: `make`).

### 2.3 설치 및 패키징 단계
*   **`do_install`**: 컴파일된 파일들을 임시 목적지 디렉토리(`D`, `${WORKDIR}/image`)에 설치합니다. 이곳은 타겟 루트 파일시스템의 구조와 동일합니다.
*   **`do_populate_sysroot`**: 다른 레시피가 이 레시피를 의존성으로 사용할 수 있도록, 헤더 파일과 라이브러리를 공용 Sysroot(`STAGING_DIR`)에 복사합니다.
*   **`do_package`**: `D` 디렉토리에 설치된 파일들을 분석하여 디버그 심볼을 분리하고, 패키지 정책에 따라 여러 논리적 패키지(`${PN}`, `${PN}-dev`, `${PN}-dbg` 등)로 나눕니다.
*   **`do_package_write_*`**: 분할된 패키지들을 실제 패키지 파일(`.rpm`, `.deb`, `.ipk`)로 생성하여 패키지 피드(`tmp/deploy/`)에 저장합니다.

### 2.4 이미지 생성 단계 (이미지 레시피 전용)
*   **`do_rootfs`**: 패키지 피드에서 필요한 패키지들을 가져와 최종 루트 파일시스템 디렉토리를 구성합니다.
*   **`do_image`**: 구성된 루트 파일시스템을 기반으로 최종 이미지 파일(ext4, wic 등)을 생성합니다.

## 3. 태스크 확인 및 관리

### 3.1 태스크 목록 확인
특정 레시피에서 실행 가능한 태스크 목록을 보려면 다음 명령어를 사용합니다.

```bash
bitbake -c listtasks <recipe-name>
```

## 4. 요약

BitBake 태스크 맵은 **"소스 다운로드 -> 패치 -> 설정 -> 컴파일 -> 설치 -> 패키징 -> 이미지 생성"**으로 이어지는 빌드 파이프라인을 정의합니다. 각 단계는 독립적인 태스크로 정의되어 있어, 개발자는 필요한 단계만 수정하거나 재실행할 수 있습니다.
