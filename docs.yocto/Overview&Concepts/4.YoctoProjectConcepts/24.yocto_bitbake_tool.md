# Yocto Project BitBake 도구 (BitBake Tool)

BitBake는 Yocto Project의 핵심 빌드 엔진으로, 메타데이터를 해석하고 작업을 스케줄링하며 실행하는 도구입니다.

## 1. 개요

BitBake는 `make`와 유사한 빌드 도구이지만, 단일 소프트웨어 패키지가 아닌 전체 임베디드 리눅스 배포판을 빌드하도록 설계되었습니다. 파이썬(Python)과 쉘 스크립트가 혼합된 언어로 작성된 레시피를 파싱하여 동작합니다.

## 2. 주요 작업 흐름 (Workflow)

BitBake는 레시피에 정의된 내용을 바탕으로 다음과 같은 순서로 작업을 수행합니다.

### 2.1 소스 가져오기 (Source Fetching)
*   **`do_fetch`**: 레시피의 `SRC_URI` 변수에 지정된 위치(Git, Tarball 등)에서 소스 코드를 다운로드하여 `DL_DIR`에 저장합니다.
*   **`do_unpack`**: 다운로드한 소스를 작업 디렉토리(`WORKDIR`)에 압축 해제합니다.

### 2.2 패치 적용 (Patching)
*   **`do_patch`**: 소스 코드에 Yocto Project 특화 패치나 버그 수정을 적용합니다. `.patch` 파일들이 소스 트리에 반영됩니다.

### 2.3 구성, 컴파일 및 스테이징 (Configuration, Compilation, and Staging)
*   **`do_configure`**: 빌드 환경을 설정합니다 (예: `./configure`, `cmake`).
*   **`do_compile`**: 소스 코드를 컴파일하여 바이너리를 생성합니다.
*   **`do_install`**: 생성된 파일을 임시 목적지 디렉토리(`D`)에 설치합니다.
*   **`do_populate_sysroot`**: 다른 패키지가 빌드될 때 참조할 수 있도록 라이브러리와 헤더 파일을 Sysroot(`STAGING_DIR`)에 복사합니다.

### 2.4 패키지 분할 (Package Splitting)
*   **`do_package`**: 설치된 파일들을 분석하여 디버그 심볼을 분리하고, 패키지 관리자 형식(RPM, DEB, IPK)에 맞게 여러 패키지(bin, dev, doc, dbg 등)로 나눕니다.
*   **`do_package_write_*`**: 실제 패키지 파일(`.rpm`, `.deb`, `.ipk`)을 생성하여 패키지 피드(`tmp/deploy/`)에 저장합니다.

### 2.5 이미지 생성 (Image Generation)
*   **`do_rootfs`**: 이미지 레시피의 경우, 패키지 피드에서 필요한 패키지들을 가져와 루트 파일시스템을 구성합니다.
*   최종적으로 부팅 가능한 이미지 파일(ext4, wic 등)이 생성됩니다.

### 2.6 SDK 생성 (SDK Generation)
*   **`do_populate_sdk`**: 애플리케이션 개발을 위한 크로스 컴파일 툴체인과 라이브러리를 포함하는 SDK 설치 스크립트를 생성합니다.

## 3. 고급 기능

### 3.1 스탬프 파일과 작업 재실행 (Stamp Files and Rerunning)
BitBake는 각 작업이 성공적으로 완료되면 스탬프 파일(`tmp/stamps/`)을 생성합니다.
*   이후 빌드 시 스탬프 파일을 확인하여 이미 완료된 작업은 건너뜁니다.
*   소스나 설정이 변경되면 스탬프가 무효화되어 해당 작업과 의존성 있는 작업들이 다시 실행됩니다.

### 3.2 셋씬 작업과 공유 상태 (Setscene Tasks and Shared State)
*   **Setscene Tasks**: 실제 컴파일을 수행하는 대신, 미리 빌드된 결과물(Shared State Cache)을 가져오는 작업입니다.
*   **SState Cache**: 빌드 속도를 획기적으로 높여주는 기능으로, 동일한 입력(해시)에 대한 출력을 캐시하여 재사용합니다.

## 4. 요약

BitBake는 단순한 컴파일러가 아니라, 소스 코드 다운로드부터 최종 이미지 생성까지의 전체 수명 주기를 관리하는 강력한 오케스트레이션 도구입니다.
