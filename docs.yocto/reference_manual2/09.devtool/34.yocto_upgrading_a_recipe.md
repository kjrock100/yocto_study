# Yocto Project 레시피 업그레이드 (Upgrading a Recipe)

Yocto Project에서 `devtool upgrade` 명령어를 사용하여 기존 레시피를 새로운 업스트림 버전으로 업그레이드하는 방법에 대해 설명합니다.

## 1. 개요

소프트웨어의 새로운 버전이 출시되면, Yocto Project의 레시피도 이에 맞춰 업데이트해야 합니다. `devtool upgrade` 명령은 소스 코드 다운로드, 레시피 파일 수정(버전, 체크섬, SRCREV 등), 그리고 기존 패치의 재적용(Rebase) 과정을 자동화하여 업그레이드 작업을 단순화합니다.

## 2. 기본 사용법

```bash
devtool upgrade [options] <recipe> <version>
```

*   **`<recipe>`**: 업그레이드할 레시피의 이름입니다.
*   **`<version>`**: 업그레이드할 대상 버전입니다.

### 예시

```bash
# pv 패키지를 1.6.0 버전으로 업그레이드
devtool upgrade pv 1.6.0
```

Git 기반 레시피의 경우, 버전 대신 커밋 해시나 태그를 지정할 수 있습니다.

```bash
devtool upgrade --srcrev <commit-hash> <recipe>
```

## 3. 작동 방식

명령을 실행하면 다음과 같은 작업이 수행됩니다.

1.  **소스 추출:** 지정된 버전의 소스 코드를 `build/workspace/sources/<recipe>` 디렉토리에 추출합니다.
2.  **레시피 수정:** 워크스페이스에 임시 레시피를 생성하고, `PV`(패키지 버전), `SRC_URI` 체크섬(md5, sha256), `SRCREV`(Git 리비전) 등을 새 버전에 맞게 업데이트합니다.
3.  **패치 재적용 (Rebase):** 기존 레시피에 있던 패치들을 새로운 소스 코드 위에 적용하려고 시도합니다.

## 4. 패치 충돌 해결

업그레이드 과정에서 가장 흔한 문제는 기존 패치가 새로운 소스 코드와 충돌하여 적용되지 않는 경우입니다.

*   `devtool`은 적용에 실패한 패치를 보고합니다.
*   개발자는 `build/workspace/sources/<recipe>` 디렉토리로 이동하여 Git 도구를 사용해 충돌을 해결해야 합니다.
*   패치가 더 이상 필요 없다면 삭제하고, 수정이 필요하다면 코드를 고친 후 커밋합니다.

## 5. 업그레이드 마무리

빌드 테스트(`devtool build <recipe>`)와 타겟 테스트(`devtool deploy-target`)를 마친 후, 변경 사항을 실제 레이어에 적용하려면 `devtool finish`를 사용합니다.

```bash
devtool finish <recipe> <layer-path>
```

이 명령은 수정된 레시피 파일과 갱신된 패치들을 지정된 레이어로 이동시키고 워크스페이스를 정리합니다.

---
*참고: 업그레이드가 너무 복잡하거나 구조가 완전히 바뀐 경우, `devtool upgrade` 대신 새로운 레시피를 작성하는 것이 나을 수도 있습니다.*
