# Yocto Project 레시피 작업 완료 (Finish Working on a Recipe)

Yocto Project에서 `devtool finish` 명령어를 사용하여 워크스페이스에서의 작업을 마치고 변경 사항을 영구적인 레이어에 적용하는 방법에 대해 설명합니다.

## 1. 개요

`devtool modify`, `devtool add`, `devtool upgrade` 등을 통해 워크스페이스에서 레시피를 수정하거나 생성한 후, 작업이 완료되면 `devtool finish` 명령을 사용하여 결과물을 실제 레이어(Layer)로 이동시켜야 합니다. 이 명령은 변경 사항을 패치 파일로 변환하거나 레시피를 업데이트하고, 워크스페이스에서 해당 레시피를 제거(Reset)합니다.

## 2. 기본 사용법

```bash
devtool finish [options] <recipe> <destination-layer>
```

*   **`<recipe>`**: 작업을 완료할 레시피의 이름입니다.
*   **`<destination-layer>`**: 변경 사항을 적용할 대상 레이어의 경로입니다.

## 3. 작동 방식

명령을 실행하면 레시피의 상태(새로 추가됨 vs 수정됨)에 따라 다음과 같은 작업이 수행됩니다.

1.  **패치 생성:** 워크스페이스의 소스 디렉토리(`build/workspace/sources/<recipe>`)에 있는 Git 커밋들을 분석하여 패치 파일(`.patch`)을 생성합니다.
2.  **레시피 업데이트:**
    *   **새 레시피 (`devtool add`):** 레시피 파일(`.bb`)과 관련 파일들을 대상 레이어로 이동시킵니다.
    *   **기존 레시피 수정 (`devtool modify`):**
        *   대상 레이어가 원본 레이어와 같다면, 레시피를 직접 수정합니다.
        *   대상 레이어가 다르다면, 대상 레이어에 `.bbappend` 파일을 생성하여 변경 사항(패치 등)을 연결합니다.
3.  **워크스페이스 정리:** 작업이 성공적으로 완료되면, 해당 레시피를 워크스페이스 레이어에서 제거합니다 (`devtool reset`과 유사).

## 4. 주요 옵션

### 4.1 패치 모드 (기본값)
소스 코드가 로컬 파일이나 Tarball인 경우, 또는 Git 저장소이지만 업스트림에 푸시할 수 없는 경우 사용됩니다. 변경 사항이 패치 파일로 저장되어 레이어에 포함됩니다.

```bash
devtool finish my-recipe meta-mylayer
```

### 4.2 SRCREV 모드 (`--mode=srcrev`)
소스 코드가 Git 저장소에서 관리되고 있고, 변경 사항을 해당 저장소에 푸시(Push)할 수 있는 경우 사용합니다. 패치를 생성하는 대신 레시피의 `SRCREV` 값을 업데이트합니다.

```bash
devtool finish --mode=srcrev my-recipe meta-mylayer
```
*주의: 이 모드를 사용하려면 `finish` 명령 실행 전에 소스 디렉토리에서 변경 사항을 원격 저장소에 푸시해야 합니다.*

### 4.3 강제 덮어쓰기 (`--force`, `-f`)
대상 레이어에 이미 파일이 존재할 경우 강제로 덮어씁니다.

## 5. 사용 예시

`meta-custom` 레이어에 있는 `my-app` 레시피를 수정한 후 적용하는 경우:

```bash
devtool finish my-app ../meta-custom
```

---
*참고: `devtool finish`를 실행하기 전에 반드시 소스 디렉토리에서 변경 사항을 `git commit` 해야 합니다. 커밋되지 않은 변경 사항은 무시됩니다.*
