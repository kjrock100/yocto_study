# Yocto Project 커널 관련 작업 (Kernel-Related Tasks)

이 문서는 Yocto Project에서 리눅스 커널 레시피(예: `linux-yocto`)를 처리할 때 사용되는 커널 관련 작업(Tasks)들에 대해 설명합니다. 이 작업들은 커널 설정, 컴파일, 모듈 처리 등을 담당하며 `kernel.bbclass` 및 관련 클래스들에 의해 정의됩니다.

## 1. 설정 및 구성 작업 (Configuration Tasks)

### `do_kernel_metadata`
*   **설명:** 커널 빌드에 필요한 메타데이터(패치, 설정 조각, 기능 설명 등)를 수집하고 처리합니다.
*   **역할:** `SRC_URI`에 지정된 커널 기능(.scc 파일)과 설정 조각(.cfg 파일)을 처리하여 빌드 준비를 합니다.

### `do_kernel_configme`
*   **설명:** 커널 설정 파일(`.config`)을 생성합니다.
*   **역할:** 머신 설정, 배포판 설정, 그리고 사용자 정의 설정 조각들을 병합하여 최종적인 커널 설정을 구성합니다.

### `do_kernel_configcheck`
*   **설명:** 생성된 커널 설정이 유효한지 검증합니다.
*   **역할:** 필수 설정이 누락되었거나 충돌하는 설정이 없는지 확인하고 경고를 출력합니다.

### `do_menuconfig`
*   **설명:** 터미널 기반의 그래픽 인터페이스(Menuconfig)를 실행하여 커널 설정을 대화형으로 수정할 수 있게 합니다.
*   **명령어:** `bitbake -c menuconfig virtual/kernel`
*   **역할:** 개발자가 커널 옵션을 직접 변경하고 테스트할 때 사용됩니다. 변경 사항은 `.config` 파일에 저장됩니다.

### `do_diffconfig`
*   **설명:** 현재 커널 설정(`.config`)과 기본 설정 간의 차이를 분석하여 설정 조각(Fragment) 파일(`fragment.cfg`)을 생성합니다.
*   **명령어:** `bitbake -c diffconfig virtual/kernel`
*   **역할:** `menuconfig`로 변경한 설정을 나중에 레시피에 영구적으로 적용하기 위한 `.cfg` 파일을 만들 때 유용합니다.

### `do_savedefconfig`
*   **설명:** 현재 커널 설정을 기반으로 최소한의 `defconfig` 파일을 생성합니다.
*   **명령어:** `bitbake -c savedefconfig virtual/kernel`
*   **역할:** 전체 `.config` 대신 변경된 사항만 포함하는 `defconfig`를 생성하여 소스 트리에 포함시킬 때 사용합니다.

## 2. 컴파일 및 빌드 작업 (Compile & Build Tasks)

### `do_kernel_checkout`
*   **설명:** 커널 소스 코드를 작업 디렉토리로 체크아웃합니다.
*   **역할:** Git 저장소에서 소스를 가져오는 경우, 올바른 브랜치와 커밋으로 소스 트리를 준비합니다.

### `do_compile_kernelmodules`
*   **설명:** 커널 모듈을 컴파일합니다.
*   **역할:** 커널 이미지(`vmlinuz`, `zImage` 등)와 별도로 로드 가능한 모듈(`.ko`)들을 빌드합니다.

### `do_shared_workdir`
*   **설명:** 다른 레시피(주로 외부 커널 모듈 레시피)가 커널 헤더와 스크립트를 참조할 수 있도록 공유 작업 디렉토리를 설정합니다.
*   **역할:** `Module.symvers` 파일 등을 공유 영역(`STAGING_KERNEL_DIR`)에 복사하여 외부 모듈(Out-of-tree modules) 빌드를 지원합니다.

### `do_strip`
*   **설명:** 커널 이미지와 모듈에서 디버깅 심볼을 제거(Strip)합니다.
*   **역할:** 최종 이미지의 크기를 줄이기 위해 수행됩니다.

### `do_sizecheck`
*   **설명:** 빌드된 커널 이미지의 크기가 제한을 초과하지 않는지 확인합니다.
*   **역할:** `KERNEL_IMAGE_MAXSIZE` 변수가 설정된 경우, 이보다 크면 경고나 에러를 발생시킵니다.

### `do_validate_branches`
*   **설명:** `SRCREV`가 가리키는 커밋이 올바른 브랜치에 있는지 확인합니다.
*   **역할:** 커널 소스 관리의 무결성을 보장합니다.

---
*참고: 이 내용은 Yocto Project 참조 매뉴얼의 'Kernel-Related Tasks' 섹션을 기반으로 작성되었습니다.*
