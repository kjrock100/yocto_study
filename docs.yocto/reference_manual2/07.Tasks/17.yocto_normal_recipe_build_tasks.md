# Yocto Project 일반 레시피 빌드 작업 (Normal Recipe Build Tasks)

BitBake가 레시피를 처리할 때 실행하는 표준 작업(Task)들의 흐름과 설명입니다. 이 작업들은 소스 코드를 가져오는 것부터 시작하여 최종 패키지를 생성하는 과정까지를 포함합니다.

## 1. 소스 준비 (Source Preparation)

*   **`do_fetch`**: `SRC_URI` 변수에 정의된 소스 코드(Git 저장소, Tarball, 파일 등)를 다운로드하여 `DL_DIR`(다운로드 디렉토리)에 저장합니다.
*   **`do_unpack`**: 다운로드한 소스 코드의 압축을 풀거나 복사하여 작업 디렉토리(`WORKDIR`) 내의 소스 디렉토리(`S`)로 이동시킵니다.
*   **`do_patch`**: `SRC_URI`에 지정된 패치 파일(`.patch`, `.diff`)들을 소스 코드에 적용하여 수정 사항을 반영합니다.
*   **`do_prepare_recipe_sysroot`**: 레시피가 의존하는 다른 패키지(라이브러리, 헤더 등)를 `recipe-sysroot` 디렉토리에 하드링크하거나 복사하여 빌드 환경을 구성합니다.

## 2. 빌드 및 구성 (Build & Configuration)

*   **`do_configure`**: 소스 코드를 컴파일하기 위한 환경 설정을 수행합니다.
    *   Autotools를 사용하는 경우 `./configure` 스크립트를 실행합니다.
    *   CMake를 사용하는 경우 `cmake` 명령을 실행하여 `Makefile`을 생성합니다.
*   **`do_compile`**: 소스 코드를 실제로 컴파일하고 링크합니다. 주로 `make` 명령어가 실행됩니다.

## 3. 설치 및 스테이징 (Install & Staging)

*   **`do_install`**: 컴파일된 바이너리, 라이브러리, 설정 파일 등을 대상 디렉토리(`D`, Destination Directory)로 복사합니다. 이 디렉토리는 타겟 시스템의 루트 파일시스템 구조를 모방합니다.
*   **`do_populate_sysroot`**: 다른 레시피가 현재 레시피의 결과물(라이브러리, 헤더 파일 등)을 참조할 수 있도록, 필요한 파일들을 공용 Sysroot 영역에 복사합니다.
*   **`do_populate_lic`**: 패키지의 라이선스 정보를 추출하여 라이선스 디렉토리에 저장합니다.

## 4. 패키징 (Packaging)

*   **`do_package`**: `D` 디렉토리에 설치된 파일들을 분석하여 패키지별로 분류합니다.
    *   디버그 심볼 분리 (Debug splitting)
    *   공유 라이브러리 의존성 자동 탐지 (Shlib dependency generation)
    *   패키지 메타데이터 생성
*   **`do_packagedata`**: 패키지 생성 과정에서 분석된 데이터를 저장하여, 나중에 런타임 패키지 의존성 해결 등에 사용할 수 있게 합니다.
*   **`do_package_write_deb` / `_ipk` / `_rpm`**: 실제 배포 가능한 패키지 파일(`.deb`, `.ipk`, `.rpm`)을 생성하여 `tmp/deploy/` 디렉토리에 저장합니다.
*   **`do_package_qa`**: 생성된 패키지에 대해 품질 보증(QA) 검사를 수행합니다. (예: 잘못된 경로, 라이선스 누락, 아키텍처 불일치 등 확인)

## 5. 배포 및 정리 (Deploy & Cleanup)

*   **`do_deploy`**: 패키지 매니저를 통하지 않고 직접 배포해야 하는 파일(예: 커널 이미지, 부트로더 바이너리)을 `tmp/deploy/images/` 디렉토리에 복사합니다. 모든 레시피가 이 작업을 수행하는 것은 아닙니다.
*   **`do_build`**: 레시피의 기본 작업(Default Task)입니다. 일반적으로 위의 모든 필요한 작업들이 완료되었는지 확인하는 역할을 합니다.
*   **`do_rm_work`**: 빌드가 완료된 후 디스크 공간을 절약하기 위해 작업 디렉토리(`WORKDIR`)를 삭제합니다. (`INHERIT += "rm_work"` 설정 시 활성화)

## 6. 작업 흐름 요약

일반적인 실행 순서는 다음과 같습니다:

1.  `do_fetch`
2.  `do_unpack`
3.  `do_patch`
4.  `do_prepare_recipe_sysroot`
5.  `do_configure`
6.  `do_compile`
7.  `do_install`
8.  `do_package`
9.  `do_package_write_*`

---
*참고: 이 문서는 Yocto Project 참조 매뉴얼의 작업(Tasks) 섹션을 기반으로 작성되었습니다.*
