# Yocto Project: 레시피 업그레이드 (Upgrading Recipes)

이 문서는 Yocto Project Development Tasks Manual의 7장을 기반으로, 소프트웨어 패키지의 새 버전이 출시되었을 때 기존 레시피를 업그레이드하는 방법을 설명합니다.

## 7.1 개요 (Overview)

소프트웨어는 지속적으로 업데이트되며, 보안 패치, 버그 수정, 새로운 기능을 반영하기 위해 레시피를 최신 버전으로 유지하는 것이 중요합니다. Yocto Project는 이를 위해 자동화 도구와 수동 방법을 모두 제공합니다.

## 7.2 자동 업그레이드 도우미 사용 (Using the Auto Upgrade Helper - AUH)

Auto Upgrade Helper(AUH)는 레시피 업그레이드 과정을 자동화하는 유틸리티입니다.

* **기능**: 업스트림의 새 버전을 감지하고, 레시피를 수정하며, 빌드를 테스트하고, 결과를 이메일로 보고합니다.
* **설정**: `upgrade-helper.conf` 파일을 통해 설정하며, 유지 관리자(Maintainer)가 주로 사용합니다.
* **장점**: 대규모 레시피 관리에 효율적입니다.

## 7.3 devtool upgrade 사용 (Using devtool upgrade)

`devtool`은 개발자가 개별 레시피를 쉽게 업그레이드할 수 있도록 `upgrade` 명령어를 제공합니다. 가장 권장되는 방법입니다.

* **명령어**:

    ```bash
    devtool upgrade <recipe_name> <new_version>
    ```

* **작동 방식**:
    1. 소스 코드를 작업 공간(workspace)으로 가져옵니다.
    2. 레시피 파일의 버전(`PV`)과 체크섬을 업데이트합니다.
    3. 기존 패치를 새 소스 코드에 리베이스(Rebase)하려고 시도합니다.
    4. 성공하면 작업 공간에 업그레이드된 레시피를 생성합니다.

* **후속 작업**:
  * 패치 충돌이 발생하면 작업 공간의 소스 디렉토리에서 수동으로 해결해야 합니다.
  * 빌드 및 테스트 후 `devtool finish`를 사용하여 변경 사항을 원래 레이어에 적용합니다.

## 7.4 수동으로 레시피 업그레이드 (Manually Upgrading a Recipe)

도구를 사용할 수 없거나 세밀한 제어가 필요한 경우 수동으로 업그레이드합니다.

1. **파일 이름 변경**: 레시피 파일(`.bb`)의 이름을 새 버전에 맞게 변경합니다. (예: `package_1.0.bb` -> `package_1.1.bb`)
2. **체크섬 업데이트**: `SRC_URI`가 가리키는 새 소스 파일의 체크섬(`md5sum`, `sha256sum`)을 구하여 레시피를 수정합니다.
3. **라이선스 확인**: `LIC_FILES_CHKSUM`이 가리키는 라이선스 파일이 변경되었는지 확인합니다. 변경되었다면 내용을 검토하고 체크섬을 업데이트합니다.
4. **패치 점검**: 기존 패치가 새 버전에서도 필요한지, 혹은 업스트림에 포함되었는지 확인합니다. 필요하다면 패치를 갱신(Refresh)합니다.
5. **빌드 테스트**: `bitbake`를 실행하여 빌드가 성공하는지 확인합니다.

---
참고: 업그레이드 시 가장 흔한 문제는 기존 패치가 새 소스 코드에 적용되지 않는 것입니다. 이 경우 패치 내용을 분석하여 수정하거나 제거해야 합니다.
