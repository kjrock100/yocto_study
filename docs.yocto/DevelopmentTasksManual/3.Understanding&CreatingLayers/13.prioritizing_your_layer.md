# 레이어 우선순위 설정 (Prioritizing Your Layer)

Yocto Project에서 여러 레이어를 사용할 때, 서로 다른 레이어가 동일한 레시피나 설정 파일을 제공하는 경우가 발생할 수 있습니다. 이때 어떤 레이어의 내용을 사용할지 결정하기 위해 **레이어 우선순위(Layer Priority)**를 설정합니다.

## 1. 레이어 우선순위란?

레이어 우선순위는 BitBake가 동일한 이름과 버전을 가진 레시피를 여러 레이어에서 발견했을 때, 어느 것을 선택할지 결정하는 기준이 됩니다.

- **높은 값**: 우선순위가 높습니다.
- **낮은 값**: 우선순위가 낮습니다.

예를 들어, `meta-A`(우선순위 5)와 `meta-B`(우선순위 6)가 모두 `example_1.0.bb`를 가지고 있다면, 우선순위가 더 높은 `meta-B`의 레시피가 사용됩니다.

## 2. 우선순위 설정 방법

레이어의 우선순위는 해당 레이어의 `conf/layer.conf` 파일에서 `BBFILE_PRIORITY` 변수를 통해 설정합니다.

### 2.1. conf/layer.conf 예시

```bash
BBFILE_COLLECTIONS += "meta-mylayer"
BBFILE_PATTERN_meta-mylayer = "^${LAYERDIR}/"
BBFILE_PRIORITY_meta-mylayer = "6"
```

- **BBFILE_COLLECTIONS**: 레이어의 컬렉션 이름을 정의합니다.
- **BBFILE_PATTERN**: 레이어 디렉토리를 식별하기 위한 정규 표현식입니다.
- **BBFILE_PRIORITY**: 정수값으로 우선순위를 지정합니다.

### 2.2. 일반적인 우선순위 값

- **Poky (meta)**: 5
- **Meta-OE**: 6
- **BSP 레이어**: 보통 5~10 사이
- **사용자 정의 레이어**: 보통 6 이상으로 설정하여 기본 레시피를 오버라이드할 수 있도록 합니다.

## 3. 우선순위 확인 (Checking Layer Priority)

현재 설정된 레이어들의 우선순위를 확인하려면 `bitbake-layers` 명령어를 사용합니다.

```bash
bitbake-layers show-layers
```

이 명령어는 활성화된 모든 레이어의 경로와 할당된 우선순위 값을 목록으로 보여줍니다.

## 4. 주의사항

- **버전 우선**: BitBake는 기본적으로 **가장 높은 버전**의 레시피를 선호합니다. 레이어 우선순위는 레시피의 버전(`PV`)이 동일할 때 적용되는 기준입니다.
- **PREFERRED_VERSION**: 특정 버전을 강제로 사용하고 싶다면 `local.conf` 등에서 `PREFERRED_VERSION`을 설정해야 합니다.
- **bbappend**: `.bbappend` 파일은 원본 레시피에 내용을 추가하는 것이므로, 우선순위와 관계없이 원본 레시피가 선택되면 함께 적용됩니다. 단, 여러 레이어에 `.bbappend`가 있을 경우 적용 순서는 레이어 설정 순서에 영향을 받습니다.

## 5. 글로벌 설정 제공 (Providing Global-level Configurations)

레이어는 레시피뿐만 아니라 배포판 설정이나 머신 설정과 같은 글로벌 설정도 제공할 수 있습니다. 이때도 레이어 우선순위가 적용되지만, `local.conf`와 같은 사용자 설정이 가장 높은 우선순위를 가집니다.
