# Yocto Project 레이어 이해 및 생성 (Understanding and Creating Layers)

Yocto Project의 가장 강력한 기능 중 하나는 **레이어(Layer)** 시스템입니다. 레이어를 사용하면 서로 다른 유형의 커스터마이징(BSP, 배포판 설정, 소프트웨어 패키지 등)을 분리하여 관리할 수 있습니다. 이 문서는 레이어를 생성하고 관리하는 방법을 설명합니다.

## 1. 레이어란 무엇인가?
레이어는 관련된 메타데이터(레시피, 설정 파일 등)의 집합입니다.
- **모듈성**: 특정 하드웨어나 기능을 위한 설정을 별도의 레이어로 분리하여 재사용성을 높입니다.
- **격리**: Yocto Project의 핵심 데이터(Poky 등)를 수정하지 않고, 자신의 레이어에서 변경 사항을 적용할 수 있어 업그레이드가 용이합니다.

## 2. 레이어 생성 (Creating Your Own Layer)
수동으로 디렉토리를 만들 수도 있지만, `bitbake-layers` 스크립트를 사용하는 것이 가장 쉽고 권장되는 방법입니다.

- **명령어**:
  ```bash
  bitbake-layers create-layer meta-mylayer
  ```
  이 명령은 `meta-mylayer`라는 디렉토리를 생성하고, 그 안에 필수적인 `conf/layer.conf` 파일과 예제 레시피를 자동으로 구성해 줍니다.

## 3. 레이어 구조 및 모범 사례 (Best Practices)
- **이름 규칙**: 관례적으로 레이어 이름은 `meta-`로 시작합니다 (예: `meta-custom`, `meta-raspberrypi`).
- **디렉토리 구조**:
  - `conf/layer.conf`: 레이어의 기본 설정을 담고 있습니다.
  - `recipes-example/`: 예제 레시피가 들어갑니다. 실제 작업 시 기능별로 `recipes-kernel`, `recipes-core` 등으로 분류합니다.
- **호환성 설정**: `conf/layer.conf` 파일 내의 `LAYERSERIES_COMPAT` 변수를 통해 해당 레이어가 지원하는 Yocto 릴리스(예: `scarthgap`, `kirkstone`)를 명시해야 합니다.

## 4. 레이어 활성화 (Enabling Your Layer)
레이어를 생성했다고 해서 빌드 시스템이 자동으로 인식하는 것은 아닙니다. `bblayers.conf` 파일에 레이어 경로를 추가해야 합니다.

- **명령어 사용 (권장)**:
  ```bash
  bitbake-layers add-layer ../meta-mylayer
  ```
- **수동 편집**: `build/conf/bblayers.conf` 파일의 `BBLAYERS` 변수에 레이어의 절대 경로를 추가합니다.

## 5. 메타데이터 확장 (.bbappend)
기존 레시피를 수정하고 싶을 때, 원본 파일을 복사해서 수정하는 대신 `.bbappend` 파일을 사용합니다.
- **파일명**: 원본 레시피와 동일한 이름에 확장자만 `.bbappend`로 만듭니다. (예: `busybox_1.36.bb` -> `busybox_%.bbappend`)
- **기능**: 패치 적용, 파일 추가, 변수 값 변경 등을 수행할 수 있습니다.
- **주의**: 버전 업그레이드 시 `.bbappend` 파일이 적용되지 않을 수 있으므로 `_%.bbappend`와 같이 와일드카드를 사용하는 것이 일반적입니다.

## 6. 레이어 우선순위 (Layer Priority)
여러 레이어에 동일한 레시피가 존재할 경우, 우선순위에 따라 어떤 레시피를 사용할지 결정합니다.
- **설정**: `conf/layer.conf` 파일의 `BBFILE_PRIORITY` 변수로 설정합니다. 숫자가 클수록 우선순위가 높습니다.

## 7. 레이어 관리 도구 (Managing Layers)
`bitbake-layers` 명령어를 통해 다양한 작업을 수행할 수 있습니다.
- `bitbake-layers show-layers`: 현재 설정된 레이어 목록과 우선순위를 보여줍니다.
- `bitbake-layers show-recipes`: 사용 가능한 모든 레시피 목록을 보여줍니다.
- `bitbake-layers show-appends`: 적용된 `.bbappend` 파일 목록을 보여줍니다.
