# 레이어 생성 시 모범 사례 (Following Best Practices When Creating Layers)

Yocto Project에서 레이어를 생성할 때 표준 규칙과 모범 사례를 따르면, 레이어의 재사용성을 높이고 유지보수를 쉽게 만들며 다른 레이어와의 충돌을 방지할 수 있습니다. 이 문서는 레이어 개발 시 고려해야 할 주요 사항들을 설명합니다.

## 1. 레이어 이름 규칙 (Layer Naming)

- **접두사 사용**: 모든 레이어 이름은 `meta-`로 시작해야 합니다 (예: `meta-myproject`, `meta-raspberrypi`).
- **명확성**: 레이어의 목적을 명확히 나타내는 이름을 사용합니다.

## 2. 디렉토리 구조 준수 (Directory Structure)

표준화된 디렉토리 구조를 사용하여 다른 개발자가 레이어를 쉽게 이해할 수 있도록 합니다.

- **conf/**: `layer.conf` 및 배포판/머신 설정 파일 위치.
- **recipes-core/**, **recipes-kernel/**: 레시피를 기능별로 분류하여 저장합니다.
- **classes/**: 사용자 정의 클래스 파일(`.bbclass`) 위치.

## 3. 의존성 관리 (Dependency Management)

- **LAYERDEPENDS**: `conf/layer.conf` 파일에 레이어가 의존하는 다른 레이어를 명시합니다.

  ```bash
  LAYERDEPENDS_meta-mylayer = "core openembedded-layer"
  ```

- **최소화**: 가능한 한 의존성을 줄여 레이어의 독립성을 유지합니다.

## 4. 메타데이터 수정 시 주의사항 (.bbappend)

기존 레시피를 수정하기 위해 `.bbappend` 파일을 사용할 때 다음 사항을 주의해야 합니다.

- **버전 독립적 이름 사용**: 특정 버전에 종속되지 않도록 `%` 와일드카드를 사용합니다.
  - 나쁜 예: `busybox_1.36.bbappend` (버전 업그레이드 시 깨짐)
  - 좋은 예: `busybox_%.bbappend`
- **영향 범위 제한**: `.bbappend` 파일은 해당 레이어가 포함된 모든 빌드에 영향을 미칩니다. 특정 머신이나 배포판에만 적용되도록 조건을 거는 것이 좋습니다.

  ```bash
  # 특정 머신에만 적용
  COMPATIBLE_MACHINE:my-machine = "my-machine"
  ```

## 5. 레이어 우선순위 (Layer Priority)

- **BBFILE_PRIORITY**: 다른 레이어와 동일한 레시피를 제공할 때 충돌을 해결하기 위해 우선순위를 설정합니다. 일반적으로 머신 레이어나 배포판 레이어는 높은 우선순위를 가집니다.

## 6. 호환성 명시 (Compatibility)

- **LAYERSERIES_COMPAT**: 레이어가 지원하는 Yocto Project 릴리스(예: `scarthgap`, `kirkstone`)를 명확히 지정하여, 호환되지 않는 버전에서 빌드되는 것을 방지합니다.

## 7. 문서화 (Documentation)

- **README 파일**: 레이어의 최상위 디렉토리에 `README` 파일을 포함해야 합니다.
  - 레이어 설명
  - 의존성 목록
  - 메인테이너(Maintainer) 연락처
  - 빌드 및 적용 방법
  - 라이선스 정보
