# bmaptool을 사용하여 이미지 플래싱하기 (Flashing Images Using bmaptool)

`bmaptool`은 시스템 이미지를 SD 카드나 USB 스틱 같은 블록 장치에 빠르고 안전하게 기록(Flash)하기 위한 도구입니다. Yocto Project에서는 생성된 이미지를 타겟 미디어에 기록할 때 `dd` 대신 `bmaptool`을 사용할 것을 권장합니다.

## 1. bmaptool을 사용하는 이유

전통적으로 사용되던 `dd` 명령어와 비교했을 때 `bmaptool`은 다음과 같은 장점이 있습니다.

* **속도**: `dd`는 이미지의 빈 공간(zero-filled blocks)까지 모두 기록하지만, `bmaptool`은 블록 맵(`.bmap`) 파일을 사용하여 실제 데이터가 있는 블록만 기록하므로 훨씬 빠릅니다.
* **데이터 무결성**: 기록하는 동안 체크섬(SHA256 등)을 실시간으로 검증하여 데이터가 올바르게 쓰였는지 확인합니다.
* **안전성**: 실수로 마운트된 파티션에 덮어쓰는 것을 방지하는 보호 기능이 있어, 시스템 디스크를 날리는 실수를 줄여줍니다.

## 2. bmap 파일 생성하기

`bmaptool`을 사용하려면 이미지 파일 외에도 해당 이미지의 블록 정보를 담은 `.bmap` 파일이 필요합니다.

* Yocto Project에서 `wic` 이미지를 생성하면 기본적으로 `.wic.bmap` 파일이 함께 생성됩니다.
* 만약 생성되지 않는다면 `local.conf` 또는 이미지 레시피의 `IMAGE_FSTYPES` 변수에 `wic.bmap`이 포함되어 있는지 확인해야 합니다.

## 3. bmaptool 설치

대부분의 최신 리눅스 배포판에서 패키지 관리자를 통해 쉽게 설치할 수 있습니다.

```bash
# Ubuntu/Debian
sudo apt-get install bmap-tools

# Fedora
sudo dnf install bmap-tools
```

## 4. 사용 방법

기본 구문은 다음과 같습니다. `bmaptool`은 이미지 파일과 같은 디렉토리에 있는 `.bmap` 파일을 자동으로 찾아서 사용합니다.

```bash
sudo bmaptool copy <image-file> <block-device>
```

### 사용 예시

`core-image-minimal.wic` 이미지를 `/dev/sdc` 장치(SD 카드 리더기 등)에 기록하는 경우:

```bash
sudo bmaptool copy core-image-minimal-qemux86-64.wic /dev/sdc
```

명령을 실행하면 진행률, 기록 속도, 그리고 마지막에 체크섬 검증 성공 여부가 출력됩니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Flashing Images Using bmaptool' 섹션을 기반으로 작성되었습니다.*
