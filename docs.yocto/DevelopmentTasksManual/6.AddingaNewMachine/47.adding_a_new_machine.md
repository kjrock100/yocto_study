# Yocto Project: 새로운 머신 추가 (Adding a New Machine)

이 문서는 Yocto Project Development Tasks Manual의 6장을 기반으로, 새로운 타겟 하드웨어(머신)를 위한 설정을 추가하는 방법을 설명합니다.

## 6.1 개요 (Overview)

Yocto Project에서 새로운 하드웨어를 지원하려면 해당 하드웨어의 아키텍처, 커널, 부트로더, 드라이버 등을 정의하는 "머신(Machine)" 설정을 추가해야 합니다. 이는 주로 새로운 BSP(Board Support Package) 레이어를 생성하고 그 안에 머신 구성 파일을 작성하는 작업으로 이루어집니다.

## 6.2 머신 구성 파일 추가 (Adding the Machine Configuration File)

머신 구성 파일은 `conf/machine/<machine-name>.conf` 경로에 위치하며, 하드웨어의 전반적인 특성을 정의합니다.

* **필수 변수**:
  * `TARGET_ARCH`: 타겟 시스템의 아키텍처 (예: `arm`, `x86_64`).
  * `PREFERRED_PROVIDER_virtual/kernel`: 사용할 커널 레시피 지정.
  * `MACHINE_FEATURES`: 하드웨어가 지원하는 기능 목록 (예: `wifi`, `bluetooth`, `screen`, `touchscreen`).

* **예시 (`conf/machine/myboard.conf`)**:

    ```bitbake
    #@TYPE: Machine
    #@NAME: My Custom Board
    #@DESCRIPTION: Machine configuration for my custom board

    TARGET_ARCH = "arm"
    
    PREFERRED_PROVIDER_virtual/kernel = "linux-myboard"
    PREFERRED_PROVIDER_virtual/bootloader = "u-boot-myboard"

    MACHINE_FEATURES = "usbgadget usbhost vfat alsa screen touchscreen wifi"
    
    KERNEL_IMAGETYPE = "zImage"
    KERNEL_DEVICETREE = "myboard.dtb"
    
    SERIAL_CONSOLES = "115200;ttyS0"
    ```

## 6.3 머신을 위한 커널 추가 (Adding a Kernel for the Machine)

머신 구성 파일에서 지정한 커널(`PREFERRED_PROVIDER_virtual/kernel`)을 제공하는 레시피가 필요합니다.

* **커널 레시피**: 보통 `recipes-kernel/linux/` 디렉토리에 위치합니다.
* **설정**: `defconfig`를 통해 커널 빌드 옵션을 설정하고, 디바이스 트리(Device Tree) 파일을 포함하여 하드웨어 구성을 커널에 알립니다.
* **Yocto 커널 도구**: `linux-yocto` 레시피를 기반으로 하거나, 커스텀 소스를 사용하는 레시피를 작성할 수 있습니다.

## 6.4 폼팩터 구성 파일 추가 (Adding a Formfactor Configuration File)

GUI 환경(예: Sato)을 사용하는 경우, 장치의 물리적 특성(화면 방향, 키보드 유무 등)을 정의하는 폼팩터 설정이 필요할 수 있습니다.

* **위치**: `recipes-bsp/formfactor/files/<machine-name>/machconfig`
* **내용**:

    ```text
    HAVE_TOUCHSCREEN=1
    HAVE_KEYBOARD=0
    DISPLAY_WIDTH_PIXELS=800
    DISPLAY_HEIGHT_PIXELS=480
    ```

---
참고: 새로운 머신을 추가할 때는 기존의 유사한 머신 설정(예: `poky/meta-yocto-bsp/conf/machine/`)을 복사하여 수정하는 것이 가장 좋은 시작점입니다.