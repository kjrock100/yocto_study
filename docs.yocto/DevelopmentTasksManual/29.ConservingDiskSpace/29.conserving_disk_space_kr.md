# 디스크 공간 절약하기 (Conserving Disk Space)

Yocto Project 빌드 시스템은 빌드 과정에서 매우 많은 디스크 공간을 소비합니다. 특히 대규모 프로젝트나 여러 이미지를 빌드할 때 수백 기가바이트의 공간이 필요할 수 있습니다. 이 섹션에서는 빌드 중 디스크 공간을 절약하고, 오래된 캐시 파일을 정리하는 방법을 설명합니다.

## 1. 빌드 중 디스크 공간 절약 (Conserving Disk Space During Builds)

빌드 시스템은 각 레시피에 대해 소스 추출, 컴파일, 설치 등의 작업을 수행하며 `tmp/work` 디렉토리에 많은 임시 파일을 생성합니다.

### 1.1 rm_work 클래스 사용

가장 효과적인 방법은 `rm_work` 클래스를 사용하는 것입니다. 이 클래스는 레시피의 빌드 작업이 완료되면 해당 작업 디렉토리(work directory)를 자동으로 삭제합니다.

* **설정 방법**: `conf/local.conf` 파일에 다음을 추가합니다.

    ```bash
    INHERIT += "rm_work"
    ```

* **효과**: 빌드에 필요한 디스크 공간을 대폭 줄일 수 있습니다 (일반적으로 40~60% 절약).
* **주의 사항**: 작업 디렉토리가 삭제되므로, 빌드 완료 후 `run.do_compile` 등의 로그를 확인하거나 소스를 디버깅하기 어려울 수 있습니다.

### 1.2 특정 레시피 제외

`rm_work`를 활성화하더라도 디버깅을 위해 특정 레시피의 작업 디렉토리는 남겨두고 싶을 수 있습니다.

* **설정 방법**:

    ```bash
    RM_WORK_EXCLUDE += "linux-yocto busybox"
    ```

## 2. 오래된 공유 상태 캐시 파일 정리 (Purging Obsolete Shared State Cache Files)

`sstate-cache` 디렉토리는 빌드 속도를 높이는 핵심 요소이지만, 시간이 지남에 따라 더 이상 사용되지 않는 오래된 캐시 파일들이 쌓여 엄청난 공간을 차지하게 됩니다.

### 2.1 sstate-cache 관리 스크립트 사용

Yocto Project는 오래된 캐시 파일을 찾아 삭제해주는 스크립트를 제공합니다.

* **스크립트 위치**: `poky/scripts/sstate-cache-management.sh`
* **사용 방법**:
    1. 현재 빌드 환경 설정 (`source oe-init-build-env`)
    2. 스크립트 실행:

        ```bash
        sstate-cache-management.sh --remove-duplicated --stamps-dir=build/tmp/stamps --cache-dir=build/sstate-cache
        ```

* **주요 옵션**:
  * `--remove-duplicated`: 중복되거나 오래된 파일을 제거합니다.
  * `--stamps-dir`: 현재 활성 상태인 빌드의 스탬프 디렉토리를 지정하여, 현재 사용 중인(유효한) 캐시는 보존합니다.
  * `-d`, `--debug`: 실제로 삭제하지 않고 삭제될 파일 목록만 출력합니다 (Dry run).

### 2.2 주기적인 정리

CI/CD 환경이나 장기 프로젝트에서는 주기적으로 이 스크립트를 실행하여 디스크 공간을 확보하는 것이 좋습니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Conserving Disk Space' 섹션을 기반으로 작성되었습니다.*
