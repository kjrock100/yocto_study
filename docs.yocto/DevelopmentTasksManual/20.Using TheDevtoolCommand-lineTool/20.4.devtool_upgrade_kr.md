# devtool upgrade를 사용하여 소프트웨어의 새 버전을 지원하는 레시피 버전 생성하기 (Use devtool upgrade to Create a Version of the Recipe that Supports a Newer Version of the Software)

`devtool upgrade` 명령은 기존 레시피를 최신 업스트림 버전으로 업그레이드하는 과정을 자동화합니다. 이 명령은 새로운 소스 코드를 가져오고, 레시피의 버전 변수(`PV`) 및 체크섬을 갱신하며, 기존에 적용되어 있던 패치들을 새로운 소스 코드에 다시 적용(Rebase)하려고 시도합니다.

## 1. 기본 구문

```bash
devtool upgrade [options] <recipename> [srctree]
```

## 2. 주요 인자 및 옵션

* **recipename**: 업그레이드할 레시피의 이름입니다.
* **srctree** (선택 사항): 소스 코드를 추출할 로컬 디렉토리 경로입니다.
* **--version / -V**: 업그레이드하려는 대상 버전입니다 (예: `1.2.3`).
* **--srcrev / -S**: Git 저장소 등을 사용할 때 특정 리비전(커밋 해시)을 지정합니다.
* **--srcbranch / -B**: 특정 브랜치를 지정합니다.
* **--no-patch**: 기존 패치를 적용하지 않습니다. 새 버전에서 패치가 이미 통합되었거나, 패치 충돌을 수동으로 해결하고 싶을 때 유용합니다.

## 3. 동작 과정

1. **소스 추출**: 지정된 버전의 소스 코드를 다운로드하여 작업 공간(`workspace/sources/<recipename>`)에 추출합니다.
2. **레시피 갱신**: 레시피 파일의 `PV`(패키지 버전) 값을 변경하고, 소스 파일의 체크섬(`SRC_URI`의 md5, sha256 등)이나 `SRCREV`를 업데이트합니다.
3. **패치 적용**: 기존 레시피에 있던 패치들을 새로운 소스 코드 위에 `git rebase` 하듯이 적용합니다.
    * 패치가 성공적으로 적용되면 커밋으로 기록됩니다.
    * 충돌이 발생하면, 해당 파일에 충돌 표시(conflict markers)가 남으며 사용자가 직접 해결해야 합니다.
4. **라이선스 확인**: 라이선스 파일(`LIC_FILES_CHKSUM`)이 변경되었는지 확인합니다. 변경되었다면 빌드 시 오류가 발생할 수 있으므로 확인이 필요합니다.

## 4. 사용 예시

### 4.1 버전 지정 업그레이드

가장 일반적인 경우로, 특정 버전으로 업그레이드합니다.

```bash
devtool upgrade -V 2.5.0 my-recipe
```

### 4.2 Git 리비전 지정 업그레이드

개발 버전이나 특정 커밋으로 업그레이드할 때 사용합니다.

```bash
devtool upgrade -S a1b2c3d4e5... my-recipe
```

## 5. 후속 작업 (Follow-up)

업그레이드 명령 실행 후에는 다음과 같은 작업이 필요할 수 있습니다.

1. **충돌 해결**: 패치 적용 중 충돌이 발생했다면, 소스 디렉토리로 이동하여 충돌을 해결하고 `git add`, `git commit`을 수행해야 합니다.
2. **빌드 테스트**: `devtool build <recipename>`으로 새 버전이 정상적으로 빌드되는지 확인합니다.
3. **작업 완료**: 테스트가 끝나면 `devtool finish <recipename> <layer-path>`를 실행하여 변경된 레시피(버전 업그레이드 및 패치 변경 사항)를 실제 레이어에 반영합니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Use devtool upgrade to Create a Version of the Recipe that Supports a Newer Version of the Software' 섹션을 기반으로 작성되었습니다.*
