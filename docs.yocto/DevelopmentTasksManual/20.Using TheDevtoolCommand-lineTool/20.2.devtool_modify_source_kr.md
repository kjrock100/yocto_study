# devtool modify를 사용하여 기존 컴포넌트 소스 수정하기 (Use devtool modify to Modify the Source of an Existing Component)

`devtool modify` 명령은 이미 존재하는 레시피의 소스 코드를 수정하거나 패치를 작업할 때 사용합니다. 이 명령은 소스 코드를 작업 공간(Workspace)으로 추출하고, 빌드 시스템이 해당 로컬 소스를 사용하도록 설정하여 개발자가 자유롭게 코드를 수정하고 테스트할 수 있는 환경을 제공합니다.

## 1. 기본 구문

```bash
devtool modify [options] <recipename> [srctree]
```

## 2. 주요 인자 및 옵션

* **recipename**: 수정하려는 레시피의 이름입니다 (예: `virtual/kernel`, `busybox`).
* **srctree** (선택 사항): 소스 코드를 추출할 로컬 디렉토리 경로입니다. 지정하지 않으면 `workspace/sources/<recipename>` 경로에 자동으로 생성됩니다.
* **-x / --extract**: (기본값) 소스를 추출합니다.
* **-n / --no-extract**: 소스를 추출하지 않습니다. 이미 소스가 준비되어 있고 레시피만 작업 공간에 연결하고 싶을 때 사용합니다.
* **--no-same-dir**: 소스 트리가 이미 존재할 때 덮어쓰거나 오류를 내지 않고 진행합니다.
* **-b / --branch**: 소스를 체크아웃할 때 특정 브랜치를 지정합니다.

## 3. 작업 흐름 (Workflow)

`devtool modify`를 사용한 일반적인 개발 주기는 다음과 같습니다.

### 3.1 소스 준비 (Modify)

명령을 실행하면 소스 코드가 다운로드 및 압축 해제되고, Git 저장소로 초기화됩니다.

```bash
devtool modify my-recipe
```

이 단계에서 `workspace/appends/my-recipe.bbappend` 파일이 생성되어, 빌드 시스템이 원래 소스 대신 작업 공간의 소스를 사용하도록 설정됩니다.

### 3.2 코드 수정 및 빌드 (Edit & Build)

`workspace/sources/my-recipe` 디렉토리로 이동하여 코드를 수정합니다. 수정 후에는 다음 명령으로 컴파일을 테스트할 수 있습니다.

```bash
devtool build my-recipe
```

### 3.3 배포 및 테스트 (Deploy & Test)

타겟 장치(또는 QEMU)가 실행 중이라면, 이미지를 다시 굽지 않고 변경된 결과물만 빠르게 배포하여 테스트할 수 있습니다.

```bash
devtool deploy-target my-recipe root@192.168.7.2
```

### 3.4 변경 사항 커밋 (Commit)

소스 수정이 완료되면, 소스 디렉토리 내에서 Git을 사용하여 변경 사항을 커밋해야 합니다. `devtool`은 이 커밋들을 바탕으로 패치 파일을 생성합니다.

```bash
cd workspace/sources/my-recipe
git add .
git commit -m "Fix specific bug in functionality"
```

### 3.5 변경 사항 적용 (Finish)

작업이 완료되면 `devtool finish` 명령을 사용하여 작업 공간의 변경 사항을 실제 메타데이터 레이어(예: `meta-mylayer`)로 이동시킵니다. 이 과정에서 Git 커밋들은 `.patch` 파일로 변환되어 레시피의 `SRC_URI`에 자동으로 추가됩니다.

```bash
devtool finish my-recipe meta-mylayer
```

## 4. 작업 취소 (Reset)

수정 작업을 중단하고 작업 공간에서 레시피를 제거하여 원래 상태로 되돌리려면 `reset` 명령을 사용합니다. 소스 디렉토리는 보존되므로 필요하다면 수동으로 삭제해야 합니다.

```bash
devtool reset my-recipe
```

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Use devtool modify to Modify the Source of an Existing Component' 섹션을 기반으로 작성되었습니다.*
