# devtool add 자세히 살펴보기 (A Closer Look at devtool add)

`devtool add` 명령은 단순히 레시피 뼈대를 만드는 것을 넘어, 소스 코드를 분석하여 최대한 완성도 높은 레시피를 생성하려고 시도합니다. 이 섹션에서는 `devtool add`가 수행하는 구체적인 작업들과 다양한 소프트웨어 유형에 따른 처리 방식을 살펴봅니다.

## 1. 이름 및 버전 감지 (Name and Version)

`devtool`은 명령줄 인자, URL, 또는 소스 트리 내의 메타데이터를 분석하여 애플리케이션의 이름과 버전을 결정합니다.

* **이름**: 명령줄에 이름을 지정하지 않으면, 소스 URL의 마지막 부분(예: `my-app.git` -> `my-app`)을 기반으로 이름을 추측합니다.
* **버전**: Git 태그, `package.json`, `CMakeLists.txt` 등 프로젝트 내의 버전 정보를 담고 있는 파일을 스캔하여 버전을 결정합니다. 버전을 찾지 못하면 `PV` 변수에 `git` 해시 등을 사용하거나 기본값을 설정합니다. 사용자가 `-V` 옵션으로 직접 지정할 수도 있습니다.

## 2. 의존성 감지 및 매핑 (Dependency Detection and Mapping)

`devtool`은 내부적으로 `recipetool`을 사용하여 소스 코드를 스캔하고 빌드 의존성을 찾습니다.

* **분석 대상**: `configure.ac`, `CMakeLists.txt`, `package.json`, `setup.py`, `requirements.txt` 등의 빌드 설정 파일을 분석합니다.
* **매핑**: 발견된 라이브러리나 도구가 Yocto Project의 기존 레시피(예: `DEPENDS`)와 매핑되는지 확인하고 자동으로 추가합니다.
* **주의**: 자동 감지가 완벽하지 않을 수 있으므로, 생성된 레시피의 `DEPENDS` 변수를 검토하고 누락된 의존성을 수동으로 추가해야 할 수 있습니다.

## 3. 라이선스 감지 (License Detection)

소스 트리 내의 `COPYING`, `LICENSE`, `README` 등의 파일을 검색하여 라이선스 정보를 추출합니다.

* **LICENSE 변수**: 감지된 라이선스 유형(예: `MIT`, `GPL-2.0-only`)을 설정합니다.
* **LIC_FILES_CHKSUM**: 라이선스 파일의 경로와 체크섬(md5 등)을 생성하여 레시피에 추가합니다. 이는 향후 라이선스 내용이 변경될 경우 빌드 시스템이 이를 감지하여 경고를 발생시키기 위함입니다.

## 4. Makefile 기반 소프트웨어 추가 (Adding Makefile-Only Software)

`Autotools`나 `CMake` 같은 복잡한 빌드 시스템을 사용하지 않고 단순 `Makefile`만 사용하는 프로젝트의 경우:

* `devtool`은 `do_install` 태스크를 생성하여 컴파일된 바이너리를 적절한 위치(`/usr/bin` 등)로 복사하도록 시도합니다.
* `EXTRA_OEMAKE` 변수를 사용하여 `Make` 실행 시 필요한 인자를 설정할 수 있습니다.
* 설치 과정이 `Makefile`에 정의되어 있지 않다면, 레시피 내에서 `do_install` 함수를 직접 작성하여 파일 복사 명령(`install -m 0755 ...`)을 추가해야 합니다.

## 5. 네이티브 도구 추가 (Adding Native Tools)

타겟 장치가 아닌 빌드 호스트에서 실행되어야 하는 도구(Native tools)를 추가할 때:

* 일반적으로 레시피 이름 뒤에 `-native`를 붙여서 구분합니다.
* 레시피 내에 `BBCLASSEXTEND = "native"`를 추가하여 해당 레시피가 네이티브 변형(variant)을 생성할 수 있도록 설정합니다.
* `devtool add`로 생성된 레시피를 수동으로 수정하여 이러한 설정을 추가해야 할 수도 있습니다.

## 6. Node.js 모듈 추가 (Adding Node.js Modules)

`npm` 레지스트리나 소스를 통해 Node.js 모듈을 추가할 수 있습니다.

* **구문**: `devtool add "npm://registry.npmjs.org;name=mypackage;version=1.0.0"`
* **동작**:
  * `recipetool`은 `package.json`을 분석하여 의존성 모듈들을 가져옵니다.
  * `npm` 클래스를 상속(`inherit npm`)받아 빌드 및 패키징을 처리합니다.
  * `shrinkwrap` 파일이나 `package-lock.json`을 활용하여 의존성 버전을 고정하고 재현 가능한 빌드를 보장합니다.
  * 라이선스 정보도 `package.json`에서 추출하여 처리합니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'A Closer Look at devtool add' 섹션을 기반으로 작성되었습니다.*
