# 이미지 보안 강화하기 (Making Images More Secure)

임베디드 장치의 보안은 매우 중요합니다. Yocto Project는 이미지를 더욱 안전하게 만들기 위한 다양한 기능과 옵션을 제공합니다. 이 섹션에서는 이미지를 강화(Hardening)하기 위한 일반적인 방법과 빌드 시스템의 기능을 설명합니다.

## 1. 일반적인 고려 사항 (General Considerations)

보안을 강화하기 위한 첫 번째 단계는 공격 표면(Attack Surface)을 줄이는 것입니다.

* **패키지 최소화**: 꼭 필요한 패키지만 이미지에 포함시킵니다. `IMAGE_INSTALL`을 신중하게 관리하고, 불필요한 기능이 포함된 대형 이미지보다는 최소한의 패키지만 포함하는 이미지에서 시작하여 필요한 것만 추가하는 방식이 좋습니다.
* **디버그 도구 제거**: 프로덕션 이미지에는 GDB, strace, tcpdump 등의 디버깅 도구나 개발용 헤더 파일, 정적 라이브러리(`-dev`, `-staticdev` 패키지)가 포함되지 않도록 합니다. `EXTRA_IMAGE_FEATURES`에서 `debug-tweaks`나 `tools-debug`가 제거되었는지 확인합니다.
* **서비스 최소화**: 부팅 시 자동으로 시작되는 네트워크 서비스(SSH, Telnet 등)를 최소화하고, 필요한 경우 방화벽을 구성합니다.

## 2. 보안 플래그 (Security Flags)

컴파일러와 링커의 보안 강화 옵션을 사용하여 바이너리 레벨에서의 취약점 공격(버퍼 오버플로우 등)을 어렵게 만들 수 있습니다. Yocto Project는 `security_flags.inc` 파일을 통해 이를 쉽게 적용할 수 있도록 지원합니다.

* **활성화 방법**: `conf/local.conf` 파일에 다음 라인을 추가하여 보안 플래그를 활성화할 수 있습니다.

    ```bash
    require conf/distro/include/security_flags.inc
    ```

* **주요 플래그**:
  * `-fstack-protector-strong`: 스택 버퍼 오버플로우 보호 기능을 활성화합니다 (Canary 사용).
  * `-D_FORTIFY_SOURCE=2`: 컴파일 타임 및 런타임에 버퍼 오버플로우를 검사합니다.
  * `-Wl,-z,relro`: GOT(Global Offset Table)를 읽기 전용으로 만들어 덮어쓰기 공격을 방지합니다.
  * `-Wl,-z,now`: 프로그램 시작 시 모든 심볼을 바인딩하여 GOT 보호를 강화합니다.

## 3. OpenEmbedded 빌드 시스템 관련 고려 사항 (Considerations Specific to the OpenEmbedded Build System)

* **사용자 계정 관리**: 기본 `root` 계정의 비밀번호를 설정하거나, `root` 로그인을 비활성화해야 합니다. `debug-tweaks` 기능이 활성화되어 있으면 비밀번호 없는 `root` 로그인이 허용되므로 프로덕션 빌드에서는 반드시 제거해야 합니다.
* **읽기 전용 루트 파일시스템**: 가능하다면 루트 파일시스템을 읽기 전용(`read-only-rootfs`)으로 설정하여 악성 코드가 시스템 파일을 변조하거나 지속성을 유지하는 것을 방지합니다.

    ```bash
    EXTRA_IMAGE_FEATURES += "read-only-rootfs"
    ```

## 4. 이미지 강화를 위한 도구 (Tools for Hardening Your Image)

Yocto Project 생태계는 보안 강화를 위한 추가적인 도구와 레이어를 제공합니다.

* **meta-security 레이어**: Yocto Project 커뮤니티에서 유지 관리하는 `meta-security` 레이어를 사용하면 다음과 같은 보안 기능을 통합할 수 있습니다.
  * **MAC (Mandatory Access Control)**: AppArmor, SELinux, Smack 등
  * **IDS (Intrusion Detection Systems)**: Samhain, Suricata 등
  * **TPM (Trusted Platform Module)**: 하드웨어 기반 보안 모듈 지원
* **취약점 검사**: `cve-check` 클래스를 사용하여 빌드에 포함된 패키지들의 알려진 취약점(CVE)을 스캔하고 보고서를 생성할 수 있습니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Making Images More Secure' 섹션을 기반으로 작성되었습니다.*
