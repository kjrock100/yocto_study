# Wic을 사용하여 파티션된 이미지 생성하기 (Creating Partitioned Images Using Wic)

Wic(OpenEmbedded Image Creator)은 Yocto Project 빌드 결과물을 사용하여 부팅 가능한 파티션된 디스크 이미지를 생성하는 도구입니다. SD 카드, eMMC, USB 스틱 등에 플래싱할 수 있는 이미지를 만드는 데 주로 사용됩니다.

## 1. 배경 (Background)

이전에는 `dd` 명령어나 복잡한 스크립트를 사용하여 이미지를 생성했지만, Wic은 이를 단순화하고 표준화했습니다. `.wks` (Kickstart) 파일을 사용하여 파티션 레이아웃을 정의하고, 빌드 시스템이 생성한 커널, 부트로더, 루트 파일시스템을 조합하여 최종 이미지를 만듭니다.

## 2. 요구 사항 (Requirements)

Wic을 사용하기 위해서는 Yocto Project 빌드 환경이 설정되어 있어야 하며, 이미지를 생성하려는 타겟에 대한 빌드 아티팩트(kernel, rootfs 등)가 존재해야 합니다.

* **필수 도구**: `parted`, `dosfstools`, `mtools` 등의 파티셔닝 및 파일시스템 도구가 호스트에 설치되어 있어야 합니다 (Yocto 빌드 시스템이 `wic-tools` 레시피를 통해 이를 준비합니다).

## 3. 도움말 얻기 (Getting Help)

Wic은 다양한 명령과 옵션을 제공합니다.

* **전체 도움말**: `wic --help`
* **사용 가능한 이미지(Kickstart 파일) 목록**: `wic list images`
* **소스 플러그인 목록**: `wic list source-plugins`

## 4. 작동 모드 (Operational Modes)

Wic은 크게 두 가지 모드로 작동할 수 있습니다.

### 4.1 Raw 모드 (Raw Mode)

가장 일반적으로 사용되는 모드입니다. Kickstart 파일(`.wks`)을 직접 지정하여 이미지를 생성합니다.

```bash
wic create <wks-file> -e <image-name>
```

### 4.2 Cooked 모드 (Cooked Mode)

기존의 빌드된 아티팩트를 사용하여 이미지를 생성하는 방식이지만, 최근에는 Raw 모드가 주로 사용됩니다.

## 5. Kickstart 파일 사용 (Using an Existing Kickstart File)

Wic은 Red Hat의 Kickstart 구문을 기반으로 한 `.wks` 파일을 사용하여 파티션 구성을 정의합니다.

* **위치**: 레이어 내의 `wic/` 디렉토리에 위치합니다 (예: `poky/scripts/lib/wic/canned-wks/`).
* **구문 예시**:

    ```text
    part /boot --source bootimg-partition --ondisk mmcblk0 --fstype=vfat --label boot --active --align 4096
    part / --source rootfs --ondisk mmcblk0 --fstype=ext4 --label root --align 4096
    ```

## 6. Wic 예제 (Wic Examples)

### 6.1 기존 Kickstart 파일로 이미지 생성

`mkefidisk.wks` 파일을 사용하여 `core-image-minimal` 이미지를 생성하는 예시입니다.

```bash
wic create mkefidisk -e core-image-minimal
```

이 명령은 `mkefidisk.wks`에 정의된 파티션 레이아웃에 따라 `core-image-minimal`의 빌드 결과물을 배치하여 이미지를 생성합니다.

### 6.2 이미지 조작 (Using Wic to Manipulate an Image)

`wic ls`, `wic cp`, `wic rm` 등의 명령을 사용하여 생성된 이미지 파일 내부의 파일을 확인하거나 수정할 수 있습니다.

```bash
wic ls my-image.wic
wic cp my-file my-image.wic:partition/path/
```

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Creating Partitioned Images Using Wic' 섹션을 기반으로 작성되었습니다.*
