# Yocto Project: 빌드에 새로운 구성 조각 생성 (Creating New Configuration Fragments In Your Build)

이 문서는 Yocto Project Development Tasks Manual의 9장을 기반으로, 리눅스 커널 등의 구성을 변경하기 위해 구성 조각(Configuration Fragments)을 생성하고 적용하는 방법을 설명합니다.

## 9.1 표준 구성 조각 생성 (Creating A Standard Configuration Fragment)

구성 조각은 전체 `defconfig`를 대체하지 않고 특정 커널 옵션만 변경할 때 사용하는 작은 파일입니다. 일반적으로 `.cfg` 확장자를 가집니다.

* **작성 방법**:
    변경하려는 커널 구성 옵션(Kconfig)을 파일에 작성합니다.

    ```text
    CONFIG_USB_SERIAL=y
    CONFIG_USB_SERIAL_PL2303=m
    # CONFIG_WIFI is not set
    ```

* **적용 방법**:
    레시피(.bb) 또는 bbappend 파일의 `SRC_URI` 변수에 해당 `.cfg` 파일을 추가합니다. Yocto Project의 커널 빌드 시스템(`linux-yocto`)은 `.cfg` 확장자를 가진 파일을 자동으로 감지하여 구성 단계에서 병합합니다.

    ```bitbake
    SRC_URI += "file://my-serial-config.cfg"
    ```

## 9.2 내장 조각 생성 (Creating A Built-in Fragment)

수동으로 옵션을 찾는 대신, `menuconfig`와 `diffconfig`를 사용하여 구성을 변경하고 그 차이점을 자동으로 조각 파일로 생성할 수 있습니다.

1. **Menuconfig 실행**:

    ```bash
    bitbake -c menuconfig virtual/kernel
    ```

    메뉴에서 원하는 옵션을 변경하고 저장합니다.

2. **Diffconfig 실행**:

    ```bash
    bitbake -c diffconfig virtual/kernel
    ```

    이 명령은 원래 구성과 변경된 구성의 차이를 분석하여 `fragment.cfg` 파일을 생성합니다. 이 파일은 일반적으로 `${WORKDIR}` 내에 생성됩니다.

3. **적용**:
    생성된 `fragment.cfg` 파일을 레이어의 `files` 디렉토리로 복사하고, 이름을 적절히 변경한 후(예: `my-feature.cfg`) `SRC_URI`에 추가하여 사용합니다.

---
참고: 구성 조각을 사용하면 베이스라인 구성을 유지하면서 필요한 기능만 모듈식으로 관리할 수 있어 유지보수가 용이합니다.
