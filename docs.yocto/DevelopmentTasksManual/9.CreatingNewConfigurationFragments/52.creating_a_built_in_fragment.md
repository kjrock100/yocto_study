# Yocto Project: 내장 조각 생성 (Creating A Built-in Fragment)

이 문서는 Yocto Project Development Tasks Manual의 9.2절을 기반으로, `menuconfig`와 `diffconfig` 도구를 사용하여 커널 구성 변경 사항을 자동으로 감지하고 구성 조각(Configuration Fragment)을 생성하는 방법을 설명합니다.

## 9.2 개요 (Overview)

수동으로 Kconfig 옵션을 찾아 `.cfg` 파일을 작성하는 대신, 그래픽 인터페이스(`menuconfig`)를 통해 커널을 구성하고, 변경된 사항만을 추출하여 자동으로 조각 파일을 생성할 수 있습니다. 이 방법은 옵션의 정확한 이름이나 의존성을 일일이 확인하지 않아도 되므로 편리합니다.

## 9.2.1 Menuconfig 실행 (Running Menuconfig)

먼저 `menuconfig` 태스크를 실행하여 커널 구성 메뉴를 엽니다.

```bash
bitbake -c menuconfig virtual/kernel
```

* 메뉴가 열리면 원하는 기능을 활성화하거나 비활성화합니다.
* 변경 사항을 저장하고 종료합니다. 이때 빌드 디렉토리 내의 `.config` 파일이 업데이트됩니다.

## 9.2.2 Diffconfig 실행 (Running Diffconfig)

구성을 변경한 후 `diffconfig` 태스크를 실행합니다. 이 태스크는 원래의 구성(baseline)과 `menuconfig`로 변경된 구성을 비교하여 차이점을 추출합니다.

```bash
bitbake -c diffconfig virtual/kernel
```

## 9.2.3 조각 파일 확인 (Locating the Fragment)

`diffconfig` 태스크가 완료되면, 작업 디렉토리(`${WORKDIR}`)에 `fragment.cfg`라는 파일이 생성됩니다. 이 파일에는 `menuconfig`에서 변경한 내용만 포함되어 있습니다.

* **위치 확인**:

    ```bash
    bitbake -e virtual/kernel | grep ^WORKDIR=
    ```

    위 명령어로 확인된 경로 내에서 `fragment.cfg`를 찾을 수 있습니다.

## 9.2.4 레시피에 적용 (Applying to the Recipe)

생성된 `fragment.cfg` 파일을 사용하여 레시피를 업데이트합니다.

1. **파일 복사**: `fragment.cfg`를 레이어의 `recipes-kernel/linux/files/` 디렉토리(또는 적절한 경로)로 복사합니다.
2. **이름 변경**: 파일 이름을 기능에 맞게 변경하는 것이 좋습니다 (예: `enable-wifi.cfg`).
3. **SRC_URI 추가**: 레시피 또는 `.bbappend` 파일의 `SRC_URI` 변수에 해당 파일을 추가합니다.

    ```bitbake
    SRC_URI += "file://enable-wifi.cfg"
    ```

---
참고: 이 과정을 통해 생성된 조각 파일은 검증된 구성이므로, 수동 작성 시 발생할 수 있는 오타나 의존성 문제를 줄일 수 있습니다.
