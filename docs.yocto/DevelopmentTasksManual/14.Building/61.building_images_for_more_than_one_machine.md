# Yocto Project: 한 대 이상의 머신을 위한 이미지 빌드 (Building Images for More than One Machine)

이 문서는 Yocto Project Development Tasks Manual의 14.5절을 기반으로, 여러 종류의 타겟 하드웨어(머신)를 지원해야 할 때 빌드 환경을 효율적으로 관리하는 방법을 설명합니다.

## 14.5 개요 (Overview)

여러 타겟 머신(예: `qemux86`과 `raspberrypi`)을 위한 이미지를 빌드해야 할 때, 단일 빌드 디렉토리에서 `local.conf`의 `MACHINE` 변수만 계속 변경하며 빌드하는 것은 비효율적입니다. 이는 BitBake가 구성을 변경할 때마다 캐시를 무효화하고 메타데이터를 다시 파싱하게 만들며, 임시 파일들이 섞일 위험이 있습니다.

## 14.5.1 별도의 빌드 디렉토리 사용 (Using Separate Build Directories)

가장 권장되는 방법은 각 머신마다 별도의 빌드 디렉토리를 생성하여 사용하는 것입니다.

* **설정 방법**:
    `oe-init-build-env` 스크립트에 인자로 디렉토리 이름을 전달하여 각각의 환경을 초기화합니다.

    ```bash
    $ source oe-init-build-env build-machineA
    # conf/local.conf에서 MACHINE = "machineA" 설정

    $ source oe-init-build-env build-machineB
    # conf/local.conf에서 MACHINE = "machineB" 설정
    ```

* **장점**: 각 머신의 빌드 아티팩트(`tmp/` 디렉토리 등)가 완전히 분리되어 있어, 머신을 전환할 때 재설정이나 재빌드 오버헤드가 발생하지 않습니다.

## 14.5.2 다운로드 및 공유 상태 캐시 공유 (Sharing Downloads and Shared State Cache)

별도의 빌드 디렉토리를 사용하더라도 소스 코드 다운로드와 컴파일 캐시는 공유하여 디스크 공간과 빌드 시간을 절약해야 합니다.

* **설정**:
    공통 경로를 생성하고, 각 빌드 디렉토리의 `conf/local.conf` 파일에서 `DL_DIR`과 `SSTATE_DIR` 변수가 이 공통 경로를 가리키도록 설정합니다.

    ```bitbake
    DL_DIR = "/home/user/yocto/shared/downloads"
    SSTATE_DIR = "/home/user/yocto/shared/sstate-cache"
    ```

  * 이렇게 하면 머신 A를 위해 다운로드하거나 빌드한 구성 요소(예: 네이티브 툴, 공통 라이브러리)를 머신 B 빌드 시 다시 다운로드하거나 빌드하지 않고 재사용할 수 있습니다.

## 14.5.3 환경 변수를 통한 머신 지정 (Specifying Machine via Environment Variable)

일시적으로 다른 머신을 빌드해야 하거나 CI(Continuous Integration) 스크립트 등에서는 환경 변수를 통해 `MACHINE` 값을 오버라이드할 수 있습니다.

* **명령어**:

    ```bash
    MACHINE=qemuarm bitbake core-image-minimal
    ```

  * 주의: 이 방법은 기존 빌드 디렉토리의 설정을 덮어쓰므로, 해당 디렉토리가 다른 머신용으로 구성되어 있었다면 캐시 재검사가 발생할 수 있습니다.

---
참고: 동시에 여러 머신을 빌드해야 한다면 14.2절의 Multiconfig 기능을 사용하는 것도 고려해 볼 수 있습니다. 하지만 단순히 여러 프로젝트를 관리하는 목적이라면 별도의 빌드 디렉토리를 사용하는 것이 가장 깔끔합니다.
