# Yocto Project: 다중 구성을 사용하여 여러 타겟 이미지 빌드 (Building Images for Multiple Targets Using Multiple Configurations)

이 문서는 Yocto Project Development Tasks Manual의 14.2절을 기반으로, 단일 빌드 명령으로 서로 다른 구성을 가진 여러 타겟의 이미지를 빌드하는 방법(Multiconfig)을 설명합니다.

## 14.2 개요 (Overview)

일부 시스템은 여러 개의 프로세서나 코어를 가지고 있으며, 각각 다른 운영체제나 설정을 필요로 할 수 있습니다 (예: 메인 프로세서는 Linux, 보조 프로세서는 Baremetal 또는 RTOS). Yocto Project의 **Multiconfig** 기능을 사용하면 한 번의 BitBake 실행으로 이러한 서로 다른 타겟들을 동시에 빌드하고, 의존성을 관리할 수 있습니다.

## 14.2.1 Multiconfig 활성화 (Enabling Multiconfig)

Multiconfig를 사용하려면 빌드 환경의 `conf/local.conf` 파일에 `BBMULTICONFIG` 변수를 설정해야 합니다.

* **설정**:

    ```bitbake
    BBMULTICONFIG = "configA configB"
    ```

  * 여기서 `configA`와 `configB`는 정의할 멀티 설정의 이름입니다.

## 14.2.2 구성 파일 생성 (Creating Configuration Files)

각 설정 이름에 해당하는 구성 파일을 `conf/multiconfig/` 디렉토리에 생성해야 합니다.

* **경로**:
  * `conf/multiconfig/configA.conf`
  * `conf/multiconfig/configB.conf`

* **내용**:
    각 파일에는 해당 타겟을 위한 `MACHINE`, `TMPDIR`, `DISTRO` 등의 변수를 정의합니다. 서로 다른 `TMPDIR`을 사용하여 빌드 아티팩트가 섞이지 않도록 하는 것이 중요합니다.

    ```bitbake
    MACHINE = "qemux86"
    TMPDIR = "${TOPDIR}/tmp-configA"
    ```

## 14.2.3 빌드 실행 (Running the Build)

Multiconfig가 설정되면 `bitbake` 명령어에 `mc:` 접두사를 사용하여 특정 구성을 빌드할 수 있습니다.

* **구문**: `bitbake mc:<config_name>:<recipe_name>`
* **예시**:

    ```bash
    bitbake mc:configA:core-image-minimal
    bitbake mc:configB:core-image-sato
    ```

  * 전체를 한 번에 빌드하려면 의존성을 설정하거나 쉘 스크립트로 순차 실행할 수 있습니다.

## 14.2.4 의존성 설정 (Cross-Multiconfig Dependencies)

한 구성의 빌드 결과물이 다른 구성의 빌드에 필요한 경우(예: 펌웨어 이미지를 리눅스 루트 파일시스템에 포함), 레시피에서 `mcdepends`를 사용하여 의존성을 정의할 수 있습니다.

* **구문**: `do_task[mcdepends] = "mc:<current_config>:<dep_config>:<dep_recipe>:<dep_task>"`

---
참고: Multiconfig는 복잡한 임베디드 시스템 개발에 매우 강력한 도구이지만, 빌드 설정이 복잡해질 수 있으므로 디렉토리 구조와 변수 관리에 주의해야 합니다.
