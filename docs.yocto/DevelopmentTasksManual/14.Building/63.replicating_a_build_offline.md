# Yocto Project: 오프라인 빌드 복제 (Replicating a Build Offline)

이 문서는 Yocto Project Development Tasks Manual의 14.7절을 기반으로, 인터넷 연결이 없는 환경에서 빌드를 수행하거나 복제하는 방법을 설명합니다.

## 14.7 개요 (Overview)

보안상의 이유나 네트워크가 불안정한 환경에서는 인터넷 연결 없이 빌드를 수행해야 할 수 있습니다. 이를 위해서는 미리 필요한 모든 소스 코드를 다운로드하여 로컬 미러를 구축하고, BitBake가 네트워크 대신 이 미러를 사용하도록 설정해야 합니다.

## 14.7.1 소스 미러 준비 (Preparing the Source Mirror)

오프라인 빌드를 하려면 먼저 인터넷이 연결된 환경에서 필요한 모든 소스 파일을 다운로드해야 합니다.

1. **다운로드 디렉토리 설정**: `local.conf`에 `DL_DIR`을 설정하여 모든 다운로드가 한곳에 저장되도록 합니다.
2. **Tarball 생성**: Git과 같은 SCM(Source Control Management) 저장소의 데이터도 오프라인에서 사용할 수 있도록 Tarball로 만들어야 합니다.

    ```bitbake
    BB_GENERATE_MIRROR_TARBALLS = "1"
    ```

3. **소스 가져오기**: `bitbake -c fetchall <target>` 명령어를 사용하여 빌드에 필요한 모든 소스를 다운로드합니다.

    ```bash
    bitbake -c fetchall core-image-minimal
    ```

## 14.7.2 오프라인 빌드 설정 (Configuring the Offline Build)

소스가 준비되면, 오프라인 환경의 `local.conf` 파일에 다음 설정을 추가하여 네트워크 접근을 차단하고 로컬 미러를 사용하도록 합니다.

1. **네트워크 비활성화**:

    ```bitbake
    BB_NO_NETWORK = "1"
    ```

    이 설정은 BitBake가 네트워크에 연결하려고 하면 즉시 에러를 발생시킵니다.

2. **로컬 미러 지정**:
    준비된 `DL_DIR`을 소스 미러 URL로 지정하고 `own-mirrors` 클래스를 상속받습니다.

    ```bitbake
    SOURCE_MIRROR_URL ?= "file:///path/to/your/downloads/"
    INHERIT += "own-mirrors"
    ```

    * `file://` 프로토콜을 사용하여 로컬 경로를 지정합니다.

## 14.7.3 공유 상태 캐시 (Shared State Cache)

빌드 속도를 높이거나 특정 빌드 상태를 그대로 복제하려면 `SSTATE_DIR`도 함께 복사하여 오프라인 환경에서 사용할 수 있습니다.

---
참고: `BB_NO_NETWORK`가 설정되어 있어도 `SOURCE_MIRROR_URL`에 지정된 로컬 경로(`file://`) 접근은 허용됩니다. 만약 빌드 중 누락된 소스가 있다면 네트워크 에러가 발생하므로, 사전에 `fetchall`을 꼼꼼히 수행해야 합니다.
