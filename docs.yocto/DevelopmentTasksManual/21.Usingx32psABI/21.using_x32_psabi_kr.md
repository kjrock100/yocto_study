# x32 psABI 사용하기 (Using x32 psABI)

x32 psABI(Processor Specific Application Binary Interface)는 x86-64 아키텍처의 성능 이점과 32비트 애플리케이션의 메모리 효율성을 결합한 하이브리드 모드입니다. Yocto Project에서는 설정을 통해 x32 ABI를 사용하는 이미지를 빌드할 수 있습니다.

## 1. x32 psABI란?

x32는 프로세서가 64비트 모드(Long Mode)에서 실행되지만, 포인터와 `long` 타입에는 32비트를 사용하는 인터페이스입니다.

* **장점**:
  * **성능**: x86-64의 확장된 레지스터 세트(16개의 범용 레지스터 및 XMM/YMM 레지스터)를 모두 사용할 수 있어 32비트 x86(i686)보다 성능이 우수합니다.
  * **메모리 효율**: 64비트 포인터 대신 32비트 포인터를 사용하므로, 순수 64비트 애플리케이션에 비해 메모리 사용량(Footprint)이 적고 캐시 효율이 높습니다.
* **용도**: 메모리가 제한적이지만 고성능 연산이 필요한 임베디드 시스템에 적합합니다.

## 2. Yocto Project에서 x32 활성화하기

x32 ABI를 사용하려면 빌드 설정에서 `DEFAULTTUNE` 변수를 적절하게 설정해야 합니다.

* **설정 파일**: `conf/local.conf` 또는 머신 설정 파일
* **설정 값**:

    ```bash
    DEFAULTTUNE = "x86-64-x32"
    ```

    이 설정을 적용하면 BitBake는 x32 ABI에 맞춰 컴파일러 플래그와 라이브러리를 구성합니다.

## 3. 커널 지원 요구사항

x32 바이너리를 실행하기 위해서는 리눅스 커널에서 해당 기능이 활성화되어 있어야 합니다. Yocto Project의 표준 커널(linux-yocto)은 일반적으로 이를 지원하지만, 커널 설정을 확인할 필요가 있습니다.

* **커널 옵션**:
  * `CONFIG_X86_X32=y`: x32 ABI 지원 활성화
  * `CONFIG_X86_64=y`: 64비트 커널 필요

## 4. 주의 사항

* x32는 64비트 커널 위에서 동작하므로, 32비트 하드웨어에서는 사용할 수 없습니다.
* 대부분의 오픈 소스 소프트웨어는 x32를 잘 지원하지만, 포인터 크기와 레지스터 크기를 혼동하는 일부 저수준 코드나 어셈블리 코드가 포함된 패키지는 빌드 실패나 런타임 오류가 발생할 수 있습니다.

---
*참고: 이 문서는 Yocto Project Development Tasks Manual의 'Using x32 psABI' 섹션을 기반으로 작성되었습니다.*
