# 이미지 커스터마이징 (Customizing Images)

Yocto Project에서 제공하는 기본 이미지(예: `core-image-minimal`)를 그대로 사용하는 경우는 드뭅니다. 대부분의 경우 특정 패키지를 추가하거나 설정을 변경하여 자신만의 이미지를 생성해야 합니다. 이 문서는 이미지를 커스터마이징하는 주요 방법들을 설명합니다.

## 1. local.conf 파일을 이용한 커스터마이징 (Customizing Images Using local.conf)

가장 빠르고 간단하게 이미지를 수정하는 방법은 빌드 디렉토리의 `conf/local.conf` 파일을 사용하는 것입니다.

- **패키지 추가**: `IMAGE_INSTALL:append` 변수를 사용하여 빌드되는 모든 이미지에 특정 패키지를 추가할 수 있습니다.

  ```bash
  IMAGE_INSTALL:append = " strace"
  ```

  *주의: 패키지 이름 앞에 공백이 있어야 합니다.*

- **장점**: 별도의 레시피를 작성할 필요가 없어 테스트나 임시 변경에 유용합니다.
- **단점**: 해당 빌드 디렉토리에서 생성되는 *모든* 이미지에 적용되므로, 특정 이미지에만 적용하고 싶을 때는 적합하지 않습니다.

## 2. IMAGE_FEATURES 및 EXTRA_IMAGE_FEATURES 사용

Yocto Project는 이미지에 특정 기능 그룹(예: 패키지 관리자, 디버깅 도구 등)을 쉽게 추가할 수 있도록 `IMAGE_FEATURES` 변수를 제공합니다.

- **주요 기능**:
  - `debug-tweaks`: 루트 비밀번호 없이 로그인 허용 등 개발 편의 기능.
  - `tools-sdk`: 온보드 개발을 위한 GCC, Make 등 포함.
  - `tools-debug`: GDB, Strace 등 디버깅 도구 포함.
  - `package-management`: 타겟에서 패키지 관리(dnf, opkg 등) 기능 활성화.
  - `ssh-server-openssh`: OpenSSH 서버 설치.

- **설정 방법**: `local.conf` 파일에서 `EXTRA_IMAGE_FEATURES` 변수에 추가합니다.

  ```bash
  EXTRA_IMAGE_FEATURES ?= "debug-tweaks tools-debug"
  ```

## 3. 커스텀 이미지 레시피 작성 (.bb Files)

프로덕션 환경이나 지속적인 관리를 위해서는 기존 이미지 레시피를 기반으로 새로운 이미지 레시피(`.bb`)를 작성하는 것이 가장 좋습니다.

- **작성 방법**:
  1. 자신의 레이어에 `recipes-core/images/` 디렉토리를 생성합니다.
  2. `my-image.bb` 파일을 생성합니다.
  3. 기존 이미지를 `require` 하고 필요한 패키지를 추가합니다.

  ```bash
  require recipes-core/images/core-image-minimal.bb

  DESCRIPTION = "A custom image based on core-image-minimal"

  IMAGE_INSTALL:append = " strace htop"
  ```

## 4. 커스텀 패키지 그룹 사용 (Custom Package Groups)

여러 패키지를 묶어서 관리하고 싶다면 패키지 그룹(Package Group) 레시피를 생성하는 것이 효율적입니다.

- **개념**: 런타임 의존성 목록을 가진 메타 패키지입니다.
- **예시**: `packagegroup-my-apps.bb`

  ```bash
  DESCRIPTION = "My Custom Package Group"
  inherit packagegroup

  RDEPENDS:${PN} = "app1 app2 app3"
  ```

- **사용**: 이미지 레시피에서 `IMAGE_INSTALL:append = " packagegroup-my-apps"`로 추가합니다.

## 5. 호스트네임 커스터마이징 (Customizing an Image Hostname)

기본 호스트네임(보통 머신 이름)을 변경하려면 `base-files` 레시피의 변수를 수정해야 합니다.

- **local.conf 사용**:

  ```bash
  hostname:pn-base-files = "my-host"
  ```

- **레시피 사용**: `base-files`에 대한 bbappend 파일을 생성하여 `hostname` 파일을 수정할 수도 있습니다.
