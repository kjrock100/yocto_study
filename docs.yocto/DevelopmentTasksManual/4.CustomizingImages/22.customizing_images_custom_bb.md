# 커스텀 .bb 파일을 사용한 이미지 커스터마이징 (Customizing Images Using Custom .bb Files)

`local.conf`를 수정하는 방식은 빠르고 간편하지만, 프로젝트를 장기적으로 유지보수하거나 배포 가능한 상태로 관리하기 위해서는 **커스텀 이미지 레시피(.bb)**를 작성하는 것이 가장 권장되는 방법입니다.

## 1. 커스텀 이미지 레시피를 사용하는 이유

- **버전 관리**: 이미지 구성을 소스 제어 시스템(Git 등)에 포함시켜 변경 이력을 추적할 수 있습니다.
- **재현성**: 빌드 환경 설정(`local.conf`)에 의존하지 않고, 레시피 자체에 구성이 정의되므로 언제 어디서든 동일한 이미지를 빌드할 수 있습니다.
- **유연성**: 특정 하드웨어나 목적에 맞는 여러 종류의 이미지를 정의하고 관리할 수 있습니다.

## 2. 레시피 작성 단계

### 2.1. 디렉토리 생성

자신의 레이어 내에 이미지를 위한 디렉토리를 생성합니다. 일반적으로 `recipes-core/images/` 또는 `recipes-extended/images/` 경로를 사용합니다.

### 2.2. .bb 파일 생성

원하는 이미지 이름으로 `.bb` 파일을 생성합니다. (예: `my-custom-image.bb`)

### 2.3. 기본 이미지 포함 (require)

바닥부터 모든 것을 정의하는 대신, 기존의 안정적인 이미지(예: `core-image-minimal`)를 기반으로 시작하는 것이 효율적입니다. `require` 키워드를 사용하여 기본 이미지의 설정을 가져옵니다.

```bitbake
require recipes-core/images/core-image-minimal.bb
```

### 2.4. 메타데이터 및 패키지 설정

설명(`DESCRIPTION`), 라이선스(`LICENSE`) 등의 기본 정보를 설정하고, `IMAGE_INSTALL` 변수를 사용하여 필요한 패키지를 추가합니다.

## 3. 예제 코드 (Example)

다음은 `core-image-minimal`을 기반으로 `strace`, `htop` 패키지와 `ssh-server-openssh` 기능을 추가한 커스텀 이미지 레시피 예제입니다.

**파일 경로**: `meta-mylayer/recipes-core/images/my-custom-image.bb`

```bitbake
SUMMARY = "A custom image based on core-image-minimal"
LICENSE = "MIT"

# 기본 이미지 설정 가져오기
require recipes-core/images/core-image-minimal.bb

# 추가 패키지 설치
IMAGE_INSTALL:append = " strace htop curl"

# 이미지 기능 추가 (SSH 서버 등)
IMAGE_FEATURES += "ssh-server-openssh"
```

## 4. 빌드 실행

레시피를 작성한 후에는 BitBake를 사용하여 해당 이미지를 빌드할 수 있습니다.

```bash
bitbake my-custom-image
```
