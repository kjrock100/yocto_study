# Yocto Project: 빌드 속도 향상 (Speeding Up a Build)

이 문서는 Yocto Project Development Tasks Manual의 16장을 기반으로, 빌드 시간을 단축하고 효율성을 높이는 다양한 방법을 설명합니다.

## 16.1 개요 (Overview)

Yocto Project 빌드는 소스 코드 다운로드, 컴파일, 패키징 등 많은 작업을 수행하므로 시간이 오래 걸릴 수 있습니다. 하지만 캐시 재사용, 병렬 처리 최적화, 하드웨어 리소스 활용 등을 통해 빌드 속도를 크게 향상시킬 수 있습니다.

## 16.2 공유 상태 캐시 (Shared State Cache)

가장 효과적인 방법은 `sstate-cache`를 활용하는 것입니다. BitBake는 각 태스크의 입력이 변경되지 않았다면, 이전에 빌드된 결과를 캐시에서 가져와 재사용합니다.

* **SSTATE_DIR 공유**: 여러 빌드 디렉토리나 팀원 간에 `SSTATE_DIR`을 공유하면 중복 빌드를 방지할 수 있습니다.
* **SSTATE_MIRRORS**: 읽기 전용 미러를 설정하여 빌드 서버나 다른 사용자의 캐시를 활용할 수 있습니다.

    ```bitbake
    SSTATE_MIRRORS ?= "file://.* http://sstate.yoctoproject.org/PATH/TO/SSTATE/PATH;downloadfilename=PATH"
    ```

## 16.3 다운로드 디렉토리 공유 (Sharing Downloads)

`DL_DIR` 변수를 설정하여 다운로드된 소스 파일(tarball)을 여러 빌드 간에 공유합니다. 이는 네트워크 대역폭을 절약하고 다운로드 시간을 제거합니다.

```bitbake
DL_DIR ?= "/opt/yocto/downloads"
```

## 16.4 병렬 실행 최적화 (Optimizing Parallel Execution)

BitBake와 Make의 병렬 실행 수준을 호스트 시스템의 CPU 코어 수에 맞춰 조정합니다.

* **BB_NUMBER_THREADS**: 동시에 실행할 BitBake 태스크의 수입니다.
* **PARALLEL_MAKE**: 컴파일 시 동시에 실행할 Make 작업의 수입니다 (`-j` 옵션).

일반적으로 CPU 코어 수의 1.5배~2배 정도로 설정하거나, 코어 수와 동일하게 설정합니다.

```bitbake
BB_NUMBER_THREADS ?= "8"
PARALLEL_MAKE ?= "-j 8"
```

## 16.5 파일시스템 성능 (Filesystem Performance)

빌드 작업은 디스크 I/O가 매우 빈번하게 발생합니다.

* **로컬 디스크 사용**: 빌드 디렉토리(`${TMPDIR}`)는 반드시 로컬 디스크(SSD 권장)에 위치해야 합니다. NFS와 같은 네트워크 파일시스템은 성능 저하의 주원인입니다.
* **atime 비활성화**: 파일시스템 마운트 옵션에 `noatime`을 사용하여 파일 접근 시간 기록 오버헤드를 줄입니다.
* **Ext4 사용**: 저널링 기능이 있는 Ext4 파일시스템이 권장됩니다.

## 16.6 불필요한 작업 제외 (Disabling Unused Features)

* **RM_WORK**: 빌드가 완료된 패키지의 작업 디렉토리를 삭제하여 디스크 공간을 확보하고 I/O 부하를 줄입니다. (`INHERIT += "rm_work"`)
* **DISTRO_FEATURES**: 사용하지 않는 기능(예: `x11`, `wayland`, `opengl`)을 제거하여 빌드해야 할 패키지 수를 줄입니다.

---
참고: 빌드 서버의 RAM이 충분하다면 `tmp` 디렉토리를 RAM 디스크(tmpfs)에 마운트하는 것도 속도 향상에 도움이 될 수 있지만, 메모리 부족 시 스왑으로 인해 오히려 느려질 수 있으므로 주의해야 합니다.
