# Yocto Project: 레시피 문법 (Recipe Syntax)

이 문서는 Yocto Project Development Tasks Manual의 5.23절을 기반으로, BitBake 레시피 파일(.bb)을 작성할 때 사용되는 기본 문법과 규칙을 설명합니다.

## 5.23 개요 (Overview)

BitBake 레시피는 변수 정의, 실행 가능한 쉘(Shell) 또는 파이썬(Python) 함수 등으로 구성됩니다. 올바른 문법을 이해하는 것은 레시피가 의도한 대로 동작하게 만드는 데 필수적입니다.

## 5.23.1 변수 할당 (Variable Assignments)

BitBake는 다양한 할당 연산자를 제공하여 변수 값을 제어합니다.

* **`=` (Hard Assignment)**: 가장 기본적인 할당입니다. 변수 값은 파싱 시점이 아닌 **사용 시점**에 확장됩니다.
* **`:=` (Immediate Variable Expansion)**: 값이 할당되는 **즉시** 변수가 확장됩니다. 현재 시점의 값을 고정하고 싶을 때 사용합니다.
* **`?=` (Default Value)**: 변수가 이전에 정의되지 않았을 때만 값을 할당합니다. "Soft assignment"라고도 합니다.
* **`??=` (Weak Default Value)**: 파싱 과정이 모두 끝날 때까지 변수가 정의되지 않았을 때 값을 할당합니다. `?=`보다 우선순위가 낮습니다.
* **`+=` / `=+`**: 공백을 자동으로 포함하여 값을 뒤에 추가(`+=`)하거나 앞에 추가(`=+`)합니다.
* **`.=` / `=.`**: 공백 없이 값을 뒤에 추가(`.=` )하거나 앞에 추가(`=.`)합니다.

## 5.23.2 함수 구문 (Function Syntax)

레시피 내에서 실행 로직을 정의할 때 사용합니다.

* **쉘 함수 (Shell Functions)**: `/bin/sh` 호환 스크립트로 작성됩니다. 주로 `do_install`, `do_compile` 등의 태스크에 사용됩니다.

    ```bitbake
    do_install() {
        install -d ${D}${bindir}
        install -m 0755 ${S}/myapp ${D}${bindir}
    }
    ```

* **파이썬 함수 (Python Functions)**: `python` 키워드로 시작하며, BitBake 내부 데이터(`d`)에 접근할 때 유용합니다.

    ```bitbake
    python do_print_info() {
        bb.note("The package name is %s" % d.getVar('PN'))
    }
    ```

* **익명 파이썬 함수 (Anonymous Python Functions)**: 이름 없이 `python ()`으로 정의되며, 레시피 파싱 시점에 실행됩니다. 동적으로 변수를 설정할 때 사용됩니다.

## 5.23.3 라인 연속 (Line Continuation)

긴 라인을 가독성 좋게 여러 줄로 나눌 때 역슬래시(`\`)를 사용합니다.

```bitbake
SRC_URI = " \
    git://example.com/repo.git;protocol=https \
    file://patch1.patch \
"
```

* 주의: 문자열 내에서 역슬래시를 사용하면 줄바꿈 문자는 제거되지만, 공백은 명시적으로 처리해야 할 수 있습니다.

## 5.23.4 변수 참조 (Variable Expansion)

`${VAR}` 구문을 사용하여 변수 값을 참조합니다. BitBake는 변수를 재귀적으로 확장합니다.

## 5.23.5 오버라이드 및 연산자 (Overrides and Operators)

변수 이름 뒤에 콜론(`:`)을 사용하여 특정 조건이나 연산을 지정할 수 있습니다.

* **Append/Prepend/Remove**: `:append`, `:prepend`, `:remove` 연산자는 변수 값의 앞뒤에 텍스트를 추가하거나 제거합니다. (이 연산자들은 공백을 자동으로 추가하지 않습니다.)

    ```bitbake
    RDEPENDS:${PN}:append = " bash"
    ```

* **조건부 오버라이드**: 아키텍처(`:arm`), 머신(`:qemux86`), 패키지(`:${PN}`) 등에 따라 다른 값을 적용할 때 사용합니다.

---
참고: BitBake 문법은 매우 유연하며 강력합니다. 복잡한 로직이 필요한 경우 BitBake User Manual을 참조하여 파이썬 함수나 고급 문법을 활용할 수 있습니다.
