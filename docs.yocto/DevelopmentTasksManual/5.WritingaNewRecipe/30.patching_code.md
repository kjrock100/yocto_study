# Yocto Project: 소스 코드 패치 (Patching Code)

이 문서는 Yocto Project Development Tasks Manual의 5.7절을 기반으로, 압축 해제된 소스 코드에 패치를 적용하는 방법(Patching)에 대해 설명합니다.

## 5.7 개요 (Overview)

`do_unpack` 태스크가 완료되면, BitBake는 `do_patch` 태스크를 실행합니다. 이 단계에서는 `SRC_URI` 변수에 지정된 패치 파일들(.patch, .diff)을 찾아 소스 코드에 적용합니다. 이를 통해 업스트림 소스 코드를 수정하거나 버그를 픽스할 수 있습니다.

## 5.7.1 패치 파일 지정 (Specifying Patch Files)

패치 파일은 `SRC_URI` 변수에 추가하여 지정합니다. BitBake는 파일 확장자가 `.patch` 또는 `.diff`로 끝나는 파일을 자동으로 패치 파일로 인식하고 적용합니다.

* **예시**:

    ```bitbake
    SRC_URI = "https://example.com/source/app-1.0.tar.gz \
               file://fix-makefile.patch \
               file://0001-add-feature.patch"
    ```

## 5.7.2 패치 적용 순서 (Patch Application Order)

`SRC_URI`에 나열된 순서대로 패치가 적용됩니다. 만약 패치 간에 의존성이 있다면 순서를 올바르게 지정해야 합니다.

## 5.7.3 bbappend 파일에서 패치 추가 (Adding Patches in bbappend)

기존 레시피를 수정하지 않고 `.bbappend` 파일을 사용하여 패치를 추가할 수 있습니다. 이때 `FILESEXTRAPATHS` 변수를 사용하여 BitBake가 패치 파일을 찾을 수 있도록 검색 경로를 확장해야 합니다.

* **예시**:

    ```bitbake
    # my-recipe_%.bbappend
    FILESEXTRAPATHS:prepend := "${THISDIR}/${PN}:"

    SRC_URI += "file://my-custom-patch.patch"
    ```

  * `FILESEXTRAPATHS:prepend`: 현재 디렉토리(`${THISDIR}`) 내의 패키지 이름 폴더(`${PN}`)를 검색 경로의 가장 앞에 추가합니다.
  * `SRC_URI +=`: 기존 `SRC_URI`에 새로운 패치 파일을 추가합니다.

## 5.7.4 패치 해결 (Patch Resolution)

BitBake는 `FILESPATH` 변수에 정의된 경로들을 탐색하여 `SRC_URI`에 지정된 로컬 파일(`file://`)을 찾습니다. 일반적으로 레시피 파일이 있는 디렉토리, 패키지 이름과 동일한 하위 디렉토리 등이 기본 검색 경로에 포함됩니다.

---
참고: 패치 적용이 실패하면 빌드가 중단됩니다. 이 경우 `devtool modify`나 `quilt`를 사용하여 패치를 수정하거나 재생성해야 할 수 있습니다.
