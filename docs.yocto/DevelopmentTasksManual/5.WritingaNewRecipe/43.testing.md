# Yocto Project: 테스트 (Testing)

이 문서는 Yocto Project Development Tasks Manual의 5.20절을 기반으로, 레시피에 테스트 기능을 추가하여 패키지의 무결성을 검증하는 방법에 대해 설명합니다.

## 5.20 개요 (Overview)

패키지가 올바르게 컴파일되고 설치되었다고 해서 기능적으로 완벽하다고 보장할 수는 없습니다. Yocto Project는 패키지별 테스트를 수행할 수 있는 **ptest (Package Test)** 프레임워크를 제공합니다. 이를 통해 업스트림 소스에 포함된 테스트 스위트를 타겟 장치에 설치하고 실행할 수 있습니다.

## 5.20.1 ptest란? (What is ptest?)

ptest는 "package test"의 약자로, 빌드 타임이 아닌 런타임(타겟 장치)에서 실행되는 테스트입니다.

* **목적**: 크로스 컴파일 환경에서는 빌드 호스트에서 테스트를 실행하기 어렵기 때문에, 테스트 파일과 스크립트를 패키징하여 타겟에서 실행합니다.
* **구성**: 테스트 실행 파일, 데이터, 그리고 이를 실행하는 `run-ptest` 스크립트로 구성됩니다.

## 5.20.2 ptest 활성화 (Enabling ptest)

레시피에서 ptest를 사용하려면 다음 단계를 따릅니다.

1. **ptest 클래스 상속**:

    ```bitbake
    inherit ptest
    ```

2. **run-ptest 스크립트 준비**:
    테스트를 실행할 `run-ptest` 스크립트를 작성하고 `SRC_URI`에 추가합니다.

    ```bitbake
    SRC_URI += "file://run-ptest"
    ```

    * `run-ptest`는 쉘 스크립트로, 실제 테스트 명령어를 포함해야 합니다.

3. **테스트 파일 설치 (`do_install_ptest`)**:
    `do_install_ptest` 함수를 정의하여 테스트에 필요한 파일(실행 파일, 스크립트, 데이터 등)을 `${D}${PTEST_PATH}`로 복사합니다.

    ```bitbake
    do_install_ptest() {
        install -d ${D}${PTEST_PATH}/tests
        cp -r ${S}/tests/* ${D}${PTEST_PATH}/tests
    }
    ```

4. **의존성 추가 (`RDEPENDS`)**:
    테스트 실행에만 필요한 의존성이 있다면 `RDEPENDS:${PN}-ptest`에 추가합니다.

    ```bitbake
    RDEPENDS:${PN}-ptest += "bash make"
    ```

## 5.20.3 ptest 실행 (Running ptest)

이미지에 ptest 패키지를 포함시키려면 `DISTRO_FEATURES`에 `ptest`가 있어야 하고, `EXTRA_IMAGE_FEATURES`에 `ptest-pkgs`를 추가해야 합니다.
타겟 장치에서는 `ptest-runner` 유틸리티를 사용하여 설치된 모든 ptest를 실행할 수 있습니다.

```bash
# 타겟 장치에서
$ ptest-runner <package-name>
```

---
참고: ptest 외에도 `testimage` 클래스를 사용하여 QEMU나 하드웨어에서 부팅 후 시스템 레벨의 자동화 테스트를 수행할 수도 있습니다.
