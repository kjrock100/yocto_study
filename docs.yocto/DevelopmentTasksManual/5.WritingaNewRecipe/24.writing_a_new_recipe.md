# Yocto Project: 새로운 레시피 작성하기 (Writing a New Recipe)

이 문서는 Yocto Project Development Tasks Manual의 "Writing a New Recipe" 장을 기반으로 새로운 레시피를 작성하는 주요 개념과 절차를 요약합니다.

## 5.1 개요 (Overview)

레시피(.bb 파일)는 BitBake가 소프트웨어 패키지를 빌드하는 방법을 정의하는 기본 단위입니다. 소스 코드 위치, 적용할 패치, 빌드 옵션, 의존성, 설치 위치 등을 포함합니다.

## 5.2 기본 레시피 찾기 또는 자동 생성 (Locate or Automatically Create a Base Recipe)

처음부터 레시피를 작성하기보다 기존 도구를 활용하는 것이 효율적입니다.

* **devtool add**: 소스 트리나 URL을 지정하여 자동으로 레시피를 생성하고 작업 공간을 설정합니다.
* **recipetool create**: 소스를 분석하여 기본 레시피 파일을 생성합니다.
* **유사한 레시피 참조**: OpenEmbedded Layer Index 등에서 유사한 패키지의 레시피를 찾아 참고합니다.

## 5.3 레시피 저장 및 명명 (Storing and Naming the Recipe)

* **위치**: 일반적으로 `meta-<layer>/recipes-<category>/<package>/` 디렉토리에 저장합니다.
* **이름**: `<package>_<version>.bb` 형식을 따릅니다 (예: `zlib_1.2.11.bb`).

## 5.4 레시피 빌드 실행 (Running a Build on the Recipe)

`bitbake <recipe-name>` 명령어를 사용하여 단일 레시피를 빌드하고 테스트할 수 있습니다.

## 5.5 ~ 5.7 소스 코드 가져오기 및 준비 (Fetching, Unpacking, Patching)

* **Fetching**: `SRC_URI` 변수에 소스 코드의 URL(Git, Tarball, 로컬 파일 등)을 지정합니다.
* **Unpacking**: 다운로드한 소스는 `${WORKDIR}`에 압축 해제됩니다.
* **Patching**: `SRC_URI`에 `.patch` 또는 `.diff` 파일을 추가하면 `do_patch` 단계에서 자동으로 적용됩니다.

## 5.8 라이선스 (Licensing)

모든 레시피는 `LICENSE` 변수와 라이선스 파일의 체크섬을 확인하는 `LIC_FILES_CHKSUM` 변수를 반드시 포함해야 합니다. 이는 오픈 소스 라이선스 준수를 위해 필수적입니다.

## 5.9 의존성 (Dependencies)

* **DEPENDS**: 빌드 시 필요한 의존성 (컴파일 타임).
* **RDEPENDS**: 실행 시 필요한 의존성 (런타임).

## 5.10 ~ 5.13 구성, 컴파일 및 설치 (Configuring, Compilation, Installing)

BitBake는 `do_configure`, `do_compile`, `do_install` 태스크를 순차적으로 실행합니다.

* **Autotools/CMake/Meson**: `inherit autotools`, `inherit cmake`, `inherit meson` 등을 사용하면 표준 빌드 절차가 자동화됩니다.
* **Make**: `do_compile`에서 `oe_runmake`를 사용하거나 `EXTRA_OEMAKE`를 설정하여 빌드 인자를 전달합니다.
* **Install**: `do_install` 태스크에서 `${D}` (Destination directory)로 파일을 복사하여 설치를 수행합니다.

## 5.14 시스템 서비스 활성화 (Enabling System Services)

SysVinit 또는 systemd 서비스를 설치하고 활성화하려면 초기화 스크립트/유닛 파일을 설치하고 관련 클래스(`update-rc.d` 또는 `systemd`)를 상속받아 설정해야 합니다.

## 5.15 패키징 (Packaging)

빌드된 파일들은 `FILES` 변수(예: `FILES:${PN}`)에 정의된 규칙에 따라 패키지(IPK, RPM, DEB)로 묶입니다.

* 기본적으로 `${bindir}`, `${libdir}` 등 표준 경로의 파일들이 메인 패키지에 포함됩니다.
* `-dev`, `-dbg`, `-doc` 등의 패키지는 자동으로 생성됩니다.

## 5.21 예제 (Examples)

* **단일 .c 파일**: `do_compile`에서 직접 `${CC}`를 호출하여 컴파일합니다.
* **Makefile 기반**: `do_install`에서 `oe_runmake install DESTDIR=${D}` 등을 사용하여 설치 경로를 지정합니다.
* **Autotools/Meson**: 적절한 클래스를 상속(`inherit`)받아 복잡한 설정 없이 빌드합니다.

## 5.22 ~ 5.23 스타일 가이드 및 문법 (Style Guidelines & Syntax)

* **변수 명명**: 표준 변수명을 사용하고, 오버라이드 문법(`:append`, `:prepend`, `:remove`)을 적절히 활용합니다.
* **들여쓰기**: 탭 대신 스페이스(보통 4칸)를 사용합니다.
* **주석**: 코드의 의도를 명확히 하기 위해 주석을 작성합니다.

---
참고: 이 문서는 Yocto Project Development Tasks Manual의 목차를 기반으로 요약되었습니다. 자세한 내용은 공식 문서를 참조하십시오.
