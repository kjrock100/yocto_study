# Yocto Project: 레시피 간 파일 공유 (Sharing Files Between Recipes)

이 문서는 Yocto Project Development Tasks Manual의 5.16절을 기반으로, 레시피가 빌드 과정에서 생성한 파일(헤더, 라이브러리 등)을 다른 레시피와 공유하는 방법인 Sysroot 메커니즘에 대해 설명합니다.

## 5.16 개요 (Overview)

레시피는 종종 다른 레시피가 제공하는 파일이 필요합니다. 예를 들어, 애플리케이션을 컴파일하려면 라이브러리의 헤더 파일(`.h`)과 공유 객체(`.so`)가 필요합니다. Yocto Project는 **Sysroot**라는 스테이징 영역을 사용하여 이러한 파일 공유를 처리합니다.

## 5.16.1 Sysroot 동작 방식 (How Sysroot Works)

레시피 간 파일 공유는 `do_populate_sysroot` 태스크와 `DEPENDS` 변수를 통해 이루어집니다.

1. **설치 (`do_install`)**: 레시피 A가 파일을 `${D}` 디렉토리에 설치합니다.
2. **Sysroot 채우기 (`do_populate_sysroot`)**: BitBake는 `${D}`에 설치된 파일 중 공유가 필요한 디렉토리(예: `/usr/include`, `/usr/lib`)를 레시피 A의 Sysroot 영역으로 복사합니다.
3. **의존성 설정 (`DEPENDS`)**: 레시피 B가 `DEPENDS = "recipe-a"`를 설정합니다.
4. **사용**: 레시피 B가 빌드될 때, BitBake는 레시피 A의 Sysroot에 있는 파일들을 레시피 B의 빌드 환경(컴파일러 검색 경로 등)에 자동으로 노출시킵니다.

## 5.16.2 SYSROOT_DIRS 변수 (The SYSROOT_DIRS Variable)

`do_populate_sysroot` 태스크가 Sysroot로 복사할 디렉토리 목록은 `SYSROOT_DIRS` 변수에 정의되어 있습니다.

* **기본값**:
  * `${includedir}` (`/usr/include`)
  * `${libdir}` (`/usr/lib`)
  * `${base_libdir}` (`/lib`)
  * `${base_bindir}` (`/bin`) - 주로 네이티브 툴을 위해
  * 기타 표준 개발 경로

* **사용자 정의**:
    기본 경로 외에 다른 디렉토리(예: 설정 파일이 있는 `/etc`)를 공유해야 한다면, 레시피에서 `SYSROOT_DIRS` 변수에 해당 경로를 추가해야 합니다.

    ```bitbake
    SYSROOT_DIRS += "${sysconfdir}"
    ```

## 5.16.3 네이티브 클래스용 변수 (SYSROOT_DIRS_NATIVE)

`native` 클래스를 상속받는 레시피의 경우, `SYSROOT_DIRS_NATIVE` 변수를 사용하여 Sysroot로 복사될 디렉토리를 제어합니다. 이는 호스트 툴을 빌드할 때 사용됩니다.

## 5.16.4 파일 충돌 방지

서로 다른 두 레시피가 Sysroot의 동일한 경로에 동일한 파일을 설치하려고 하면 충돌이 발생할 수 있습니다. 이는 일반적으로 설계상의 문제이므로, 파일 경로를 변경하거나 `update-alternatives` 등을 고려해야 하지만, Sysroot 단계에서는 덮어쓰기가 발생할 수 있으므로 주의가 필요합니다.

---
참고: `do_package` 단계에서 생성되는 패키지(IPK, RPM 등)와는 별개로, `do_populate_sysroot`는 오직 빌드 타임 의존성을 해결하기 위해 파일을 공유하는 과정입니다.
