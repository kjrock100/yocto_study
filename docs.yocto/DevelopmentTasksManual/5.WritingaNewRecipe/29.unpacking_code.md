# Yocto Project: 소스 코드 압축 해제 (Unpacking Code)

이 문서는 Yocto Project Development Tasks Manual의 5.6절을 기반으로, 다운로드한 소스 코드를 빌드 작업을 위해 압축 해제하고 준비하는 과정(Unpacking)에 대해 설명합니다.

## 5.6 개요 (Overview)

`do_fetch` 태스크를 통해 소스 코드가 다운로드 디렉토리(`DL_DIR`)에 준비되면, BitBake는 `do_unpack` 태스크를 실행합니다. 이 단계에서는 소스 파일을 작업 디렉토리(`${WORKDIR}`)로 압축 해제하거나 복사합니다.

## 5.6.1 작업 디렉토리 (The Work Directory)

모든 빌드 작업은 `${WORKDIR}` 내에서 이루어집니다. `do_unpack` 태스크는 `SRC_URI`에 지정된 파일들을 이 디렉토리로 가져옵니다.

* 압축 파일(tar.gz, zip 등)은 자동으로 압축이 해제됩니다.
* 일반 파일(file://)은 그대로 복사됩니다.

## 5.6.2 소스 디렉토리 설정 (S Variable)

압축 해제 후 소스 코드의 최상위 디렉토리 위치를 BitBake에게 알려주기 위해 `S` 변수를 설정해야 합니다. `do_compile`, `do_install` 등의 태스크는 `S` 변수가 가리키는 경로에서 실행됩니다.

* **기본값**:
    BitBake는 기본적으로 다음과 같이 설정합니다.

    ```bitbake
    S = "${WORKDIR}/${BPN}-${PV}"
    ```

    이는 대부분의 오픈 소스 Tarball이 `<이름>-<버전>` 형식의 디렉토리에 담겨 있기 때문입니다.

* **Git 소스 사용 시**:
    Git 저장소에서 소스를 가져오는 경우, 보통 `git`이라는 하위 디렉토리에 체크아웃됩니다. 따라서 `S` 변수를 다음과 같이 수정해야 합니다.

    ```bitbake
    S = "${WORKDIR}/git"
    ```

* **압축 파일 구조가 다른 경우**:
    만약 Tarball이 별도의 하위 디렉토리 없이 바로 파일들을 풀거나, 디렉토리 이름이 패키지 이름과 다르다면 `S` 변수를 그에 맞게 조정해야 합니다.

    ```bitbake
    S = "${WORKDIR}/my-custom-source-dir"
    ```

## 5.6.3 로컬 파일 처리 (Handling Local Files)

`SRC_URI`에 `file://`로 지정된 로컬 파일(패치, 설정 파일, init 스크립트 등)은 `${WORKDIR}`의 최상위로 복사됩니다. 만약 특정 하위 디렉토리로 복사하고 싶다면 `subdir` 파라미터를 사용할 수 있습니다.

* **예시**:

    ```bitbake
    SRC_URI = "file://my-config.conf;subdir=configs"
    ```

    이 경우 파일은 `${WORKDIR}/configs/my-config.conf`에 위치하게 됩니다.

---
참고: `do_unpack`이 완료되면 소스 코드는 패치 적용(`do_patch`) 및 구성(`do_configure`) 단계를 거칠 준비가 됩니다.
