# Yocto Project: 가상 제공자 사용 (Using Virtual Providers)

이 문서는 Yocto Project Development Tasks Manual의 5.17절을 기반으로, 동일한 기능을 제공하는 여러 레시피 중 하나를 선택할 수 있게 해주는 가상 제공자(Virtual Providers) 개념에 대해 설명합니다.

## 5.17 개요 (Overview)

때로는 여러 레시피가 동일한 기능이나 소프트웨어 구성 요소를 제공할 수 있습니다. 예를 들어, 리눅스 커널은 `linux-yocto`, `linux-intel`, `linux-raspberrypi` 등 다양한 레시피로 제공될 수 있지만, 시스템 입장에서는 모두 "커널"입니다. Yocto Project는 **가상 제공자(Virtual Providers)**를 사용하여 이러한 상황을 관리합니다.

## 5.17.1 가상 제공자란? (What are Virtual Providers?)

가상 제공자는 특정 패키지 이름 대신 기능을 나타내는 이름입니다. 일반적으로 `virtual/` 접두사를 사용하여 일반 패키지와 구분합니다.

* **예시**:
  * `virtual/kernel`: 리눅스 커널
  * `virtual/bootloader`: 부트로더 (U-Boot, GRUB 등)
  * `virtual/libc`: C 라이브러리 (glibc, musl 등)
  * `virtual/xserver`: X 서버

## 5.17.2 제공자 선언 (Declaring a Provider)

레시피는 `PROVIDES` 변수를 사용하여 자신이 특정 가상 항목을 제공함을 알립니다.

* **예시**: `linux-myboard_5.10.bb`

    ```bitbake
    PROVIDES += "virtual/kernel"
    ```

    이 설정은 `linux-myboard` 레시피가 `virtual/kernel`을 제공한다는 것을 의미합니다.

## 5.17.3 의존성 설정 (Defining Dependencies)

다른 레시피나 이미지에서 커널이 필요할 때, 특정 커널 레시피 이름 대신 가상 제공자 이름을 `DEPENDS`에 사용합니다.

* **예시**:

    ```bitbake
    DEPENDS += "virtual/kernel"
    ```

    이렇게 하면 나중에 어떤 커널 레시피를 사용할지 유연하게 변경할 수 있습니다.

## 5.17.4 제공자 선택 (Selecting a Provider)

여러 레시피가 동일한 `virtual/` 항목을 제공하는 경우, 빌드 시스템은 어떤 것을 사용할지 결정해야 합니다. 이를 위해 `PREFERRED_PROVIDER` 변수를 사용합니다. 이 변수는 주로 `local.conf`나 머신 설정 파일(`conf/machine/<machine>.conf`)에 설정됩니다.

* **구문**: `PREFERRED_PROVIDER_<virtual-name> = "<recipe-name>"`
* **예시**:

    ```bitbake
    PREFERRED_PROVIDER_virtual/kernel = "linux-myboard"
    ```

    이 설정은 `virtual/kernel`을 요구하는 모든 의존성에 대해 `linux-myboard` 레시피를 사용하도록 강제합니다.

---
참고: `PREFERRED_PROVIDER`를 설정하지 않으면 BitBake는 우선순위 규칙(버전이 높은 것 등)에 따라 임의로 선택하거나, 여러 제공자가 있다는 에러를 발생시킬 수 있습니다. 따라서 명시적으로 설정하는 것이 좋습니다.
