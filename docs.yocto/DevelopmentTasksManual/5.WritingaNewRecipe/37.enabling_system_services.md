# Yocto Project: 시스템 서비스 활성화 (Enabling System Services)

이 문서는 Yocto Project Development Tasks Manual의 5.14절을 기반으로, 애플리케이션을 시스템 부팅 시 자동으로 시작되는 서비스로 설정하는 방법을 설명합니다.

## 5.14 개요 (Overview)

애플리케이션을 빌드하고 설치하는 것만으로는 부팅 시 자동으로 실행되지 않습니다. 이를 위해서는 초기화 매니저(SysVinit 또는 systemd)에 맞는 스크립트나 유닛 파일을 설치하고 활성화해야 합니다. Yocto Project는 이를 쉽게 처리할 수 있는 클래스들을 제공합니다.

## 5.14.1 SysVinit 서비스 활성화 (Enabling SysVinit Services)

SysVinit을 사용하는 배포판의 경우 `update-rc.d` 클래스를 사용합니다. 이 클래스는 패키지 설치 시 `update-rc.d` 도구를 호출하여 스크립트 심볼릭 링크를 생성합니다.

* **클래스 상속**:

    ```bitbake
    inherit update-rc.d
    ```

* **변수 설정**:
  * `INITSCRIPT_NAME`: `${sysconfdir}/init.d`에 설치된 초기화 스크립트의 파일명입니다.
  * `INITSCRIPT_PARAMS`: 스크립트의 실행 레벨과 우선순위를 정의합니다. (기본값: "defaults")

* **설치 작업**: `do_install` 태스크에서 스크립트를 `${D}${sysconfdir}/init.d`에 설치해야 합니다.

* **예시**:

    ```bitbake
    inherit update-rc.d

    INITSCRIPT_NAME = "myservice"
    INITSCRIPT_PARAMS = "start 99 5 2 . stop 20 0 1 6 ."

    do_install:append() {
        install -d ${D}${sysconfdir}/init.d
        install -m 0755 ${S}/myservice.sh ${D}${sysconfdir}/init.d/myservice
    }
    ```

## 5.14.2 systemd 서비스 활성화 (Enabling systemd Services)

systemd를 사용하는 배포판의 경우 `systemd` 클래스를 사용합니다.

* **클래스 상속**:

    ```bitbake
    inherit systemd
    ```

* **변수 설정**:
  * `SYSTEMD_SERVICE`: 패키지에 포함된 systemd 유닛 파일의 이름입니다. 패키지별 오버라이드(예: `:${PN}`)를 사용하는 것이 좋습니다.
  * `SYSTEMD_AUTO_ENABLE`: 서비스 자동 활성화 여부 ("enable" 또는 "disable"). 기본값은 "enable"입니다.

* **설치 작업**: `do_install` 태스크에서 유닛 파일을 `${D}${systemd_system_unitdir}`에 설치해야 합니다.

* **예시**:

    ```bitbake
    inherit systemd

    SYSTEMD_SERVICE:${PN} = "myservice.service"

    do_install:append() {
        install -d ${D}${systemd_system_unitdir}
        install -m 0644 ${S}/myservice.service ${D}${systemd_system_unitdir}
    }
    ```

## 5.14.3 두 시스템 모두 지원 (Supporting Both)

레시피에서 `update-rc.d`와 `systemd` 클래스를 모두 상속받고 관련 변수를 설정하면, 빌드되는 배포판의 초기화 매니저 설정(`DISTRO_FEATURES`)에 따라 적절한 방식이 자동으로 선택됩니다.

---
참고: 서비스 파일이 올바르게 패키징되려면 `FILES` 변수에 해당 경로가 포함되어야 합니다. systemd 유닛 파일이나 init 스크립트는 기본 경로에 설치할 경우 보통 자동으로 포함되지만, 확인이 필요할 수 있습니다.
