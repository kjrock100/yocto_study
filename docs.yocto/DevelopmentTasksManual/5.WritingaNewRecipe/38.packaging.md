# Yocto Project: 패키징 (Packaging)

이 문서는 Yocto Project Development Tasks Manual의 5.15절을 기반으로, 설치된 파일들을 패키지로 묶는 `do_package` 태스크와 관련 설정을 설명합니다.

## 5.15 개요 (Overview)

`do_install` 태스크가 완료되면, BitBake는 `do_package` 태스크를 실행합니다. 이 단계에서는 `${D}` 디렉토리에 설치된 파일들을 분석하고, `PACKAGES` 변수에 정의된 여러 패키지로 분할합니다. 이후 `do_package_write_*` 태스크를 통해 실제 패키지 파일(IPK, RPM, DEB)이 생성됩니다.

## 5.15.1 패키지 분할 (Splitting Files into Packages)

BitBake는 기본적으로 하나의 레시피에서 여러 개의 패키지를 생성합니다.

* **기본 패키지 구성 (`PACKAGES`)**:
  * `${PN}-dbg`: 디버깅 심볼 파일 및 소스 경로 정보
  * `${PN}-staticdev`: 정적 라이브러리 (.a)
  * `${PN}-dev`: 개발용 헤더 및 라이브러리 심볼릭 링크 (.so)
  * `${PN}-doc`: 문서 파일 (man pages, info 등)
  * `${PN}-locale`: 로케일 파일
  * `${PN}`: 메인 패키지 (실행 파일 및 공유 라이브러리 등 나머지 파일)

## 5.15.2 FILES 변수 (The FILES Variable)

각 패키지에 포함될 파일들은 `FILES` 변수를 통해 정의됩니다. 패키지 이름별로 오버라이드하여 설정합니다.

* **기본값**: BitBake는 `meta/conf/bitbake.conf`에 정의된 기본 규칙에 따라 표준 경로(예: `/usr/bin`, `/usr/lib`)의 파일들을 자동으로 할당합니다.
* **사용자 정의**: 기본 규칙 외에 파일을 추가하거나 변경해야 할 때 사용합니다.

    ```bitbake
    FILES:${PN} += "${bindir}/myapp ${sysconfdir}/myconfig"
    FILES:${PN}-dev += "${includedir}/myheader.h"
    ```

* **주의사항**: `PACKAGES` 변수에 나열된 순서대로 파일 매칭이 이루어집니다. 따라서 더 구체적인 파일 매칭 규칙을 가진 패키지가 목록의 앞쪽에 와야 합니다.

## 5.15.3 자동 의존성 감지 (Automatic Dependency Detection)

`do_package` 단계에서는 공유 라이브러리(.so) 의존성(shlib)을 자동으로 분석합니다.

* 실행 파일이 특정 라이브러리를 필요로 하면, 해당 라이브러리를 제공하는 패키지가 런타임 의존성(`RDEPENDS`)으로 자동 추가됩니다.
* 이를 통해 `RDEPENDS`를 일일이 수동으로 적지 않아도 라이브러리 의존성이 관리됩니다.

## 5.15.4 디버그 심볼 (Debug Symbols)

바이너리에서 스트립(strip)된 디버그 심볼은 자동으로 추출되어 `${PN}-dbg` 패키지에 저장됩니다. 이를 통해 타겟 파일 시스템의 용량을 줄이면서도, 필요 시 디버그 패키지를 설치하여 디버깅할 수 있습니다.

## 5.15.5 패키지 백엔드 (Package Backends)

실제 패키지 파일 생성은 `local.conf`의 `PACKAGE_CLASSES` 변수에 따라 결정됩니다.

* `package_rpm`: RPM 파일 (.rpm) 생성
* `package_ipk`: Opkg 파일 (.ipk) 생성
* `package_deb`: Debian 파일 (.deb) 생성

## 5.15.6 QA 검사 (QA Checks)

패키징 과정에서 `insane.bbclass`가 다양한 QA 검사를 수행합니다. 예를 들어, 설치된 파일이 패키지에 포함되지 않았거나(`installed-vs-shipped`), 아키텍처가 맞지 않는 경우 경고나 에러를 발생시킵니다.

---
참고: 설치된 파일이 어떤 패키지에도 포함되지 않으면 "Files/directories were installed but not shipped" 에러가 발생합니다. 이를 해결하려면 `FILES` 변수에 해당 파일을 추가하거나, 필요 없는 파일이라면 `do_install`에서 삭제해야 합니다.
