# Yocto Project: 배포 전 레시피의 올바른 버전 관리 (Properly Versioning Pre-Release Recipes)

이 문서는 Yocto Project Development Tasks Manual의 5.18절을 기반으로, 정식 릴리스 이전 버전(Pre-release)의 소프트웨어에 대한 레시피 버전을 지정할 때 주의해야 할 점과 올바른 방법을 설명합니다.

## 5.18 개요 (Overview)

소프트웨어의 버전 번호는 패키지 관리자(RPM, IPK, DEB)가 패키지의 업그레이드 여부를 결정하는 기준이 됩니다. 따라서 정식 릴리스 전의 버전(베타, RC 등)이나 개발 중인 스냅샷 버전을 레시피에 지정할 때는, 향후 나올 정식 버전보다 **낮은** 버전으로 인식되도록 설정해야 합니다.

## 5.18.1 버전 정렬 문제 (The Version Sorting Problem)

패키지 관리자는 버전 문자열을 비교하여 어떤 패키지가 더 최신인지 판단합니다.

* **올바른 순서**: `1.0-rc1` < `1.0`
* **잘못된 순서**: `1.0rc1` > `1.0` (문자열 비교 시 'r'이 숫자보다 뒤에 올 수 있음, 또는 구분자 처리에 따라 다름)

만약 프리 릴리스 버전을 `1.0rc1`으로 설정했는데 패키지 관리자가 이를 `1.0`보다 높게 인식한다면, 나중에 정식 `1.0` 버전이 나왔을 때 사용자는 업그레이드를 할 수 없게 됩니다.

## 5.18.2 Git 스냅샷 버전 관리 (Versioning Git Snapshots)

Git과 같은 SCM에서 소스를 가져오는 경우, 일반적으로 가장 최근의 정식 릴리스 버전을 기준으로 버전을 지정합니다.

* **정식 릴리스 이후 (Post-release)**:
    버전 1.0이 릴리스되었고, 그 이후의 커밋들을 빌드하는 경우:

    ```bitbake
    PV = "1.0+git${SRCPV}"
    ```

    `+` 기호는 일반적으로 버전의 증가를 의미하므로 `1.0`보다 높게 인식됩니다. 이는 올바른 방식입니다.

* **정식 릴리스 이전 (Pre-release)**:
    버전 1.0이 아직 릴리스되지 않았고, 1.0을 향해 개발 중인 스냅샷을 빌드하는 경우:
    **절대로** `PV = "1.0+git..."`으로 설정하면 안 됩니다. 이렇게 하면 나중에 나올 정식 `1.0`보다 버전이 높아져 버립니다.
    대신 다음과 같이 설정해야 합니다:
    1. **이전 버전 사용**: `0.9+git${SRCPV}` (0.9가 이전 버전인 경우)
    2. **임의의 낮은 버전 사용**: `0.99+git${SRCPV}`

## 5.18.3 틸드(~) 문자 사용 (Using the Tilde Character)

일부 패키지 관리 시스템(특히 DEB, 그리고 최신 RPM/Opkg 설정)에서는 틸드(`~`) 문자를 사용하여 "이전"임을 명시할 수 있습니다. `~`는 빈 문자열보다 정렬 순서가 낮습니다.

* **예시**:

    ```bitbake
    PV = "1.0~rc1"
    ```

    이 경우 `1.0~rc1` < `1.0`으로 올바르게 인식됩니다.

## 5.18.4 요약 (Summary)

* **Post-release**: `1.2+git...` (1.2보다 큼)
* **Pre-release**: `1.3~rc1` 또는 `1.2.99+git...` (1.3보다 작음)

---
참고: 항상 `bitbake -e <recipe> | grep ^PV` 명령어나 패키지 관리 도구의 버전 비교 명령을 통해 의도한 대로 정렬되는지 확인하는 것이 좋습니다.
