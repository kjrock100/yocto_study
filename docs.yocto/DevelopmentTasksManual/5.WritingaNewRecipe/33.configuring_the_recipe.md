# Yocto Project: 레시피 구성 (Configuring the Recipe)

이 문서는 Yocto Project Development Tasks Manual의 5.10절을 기반으로, 소스 코드 컴파일 전 구성(Configuration) 단계인 `do_configure` 태스크와 관련 설정을 설명합니다.

## 5.10 개요 (Overview)

`do_patch` 태스크가 완료되면 BitBake는 `do_configure` 태스크를 실행합니다. 이 단계에서는 소스 코드를 컴파일하기 위한 환경 설정, Makefile 생성 등의 작업이 수행됩니다. Yocto Project는 Autotools, CMake, Meson 등 다양한 빌드 시스템을 지원하며, 이를 위한 클래스(`inherit`)를 제공합니다.

## 5.10.1 Autotools 사용 (Using Autotools)

많은 오픈 소스 프로젝트가 Autotools(autoconf, automake)를 사용합니다. 이를 지원하기 위해 레시피에 `autotools` 클래스를 상속받습니다.

* **설정**:

    ```bitbake
    inherit autotools
    ```

* **작동 방식**: `do_configure` 태스크가 자동으로 `configure` 스크립트를 실행합니다. `--prefix`, `--host` 등의 표준 옵션이 자동으로 전달됩니다.
* **추가 옵션**: `EXTRA_OECONF` 변수를 사용하여 `configure` 스크립트에 추가 인자를 전달할 수 있습니다.

    ```bitbake
    EXTRA_OECONF += "--enable-feature --disable-other-feature"
    ```

## 5.10.2 CMake 사용 (Using CMake)

CMake를 사용하는 프로젝트는 `cmake` 클래스를 상속받습니다.

* **설정**:

    ```bitbake
    inherit cmake
    ```

* **작동 방식**: `do_configure` 태스크가 `cmake` 명령어를 실행하여 빌드 파일을 생성합니다.
* **추가 옵션**: `EXTRA_OECMAKE` 변수를 사용하여 CMake 변수 정의(`-D`) 등을 전달할 수 있습니다.

    ```bitbake
    EXTRA_OECMAKE += "-DENABLE_SSL=ON"
    ```

## 5.10.3 기타 빌드 시스템 (Other Build Systems)

* **Meson**: `inherit meson`을 사용합니다. `EXTRA_OEMESON`으로 옵션을 설정합니다.
* **QMake**: Qt 프로젝트의 경우 `inherit qmake5` 등을 사용합니다.
* **Python**: `inherit setuptools3` 등을 사용하여 Python 모듈을 빌드합니다.

## 5.10.4 PACKAGECONFIG 변수 (The PACKAGECONFIG Variable)

`PACKAGECONFIG` 변수는 레시피의 기능을 선택적으로 활성화하거나 비활성화하고, 이에 따른 의존성(`DEPENDS`, `RDEPENDS`)과 구성 옵션(`EXTRA_OECONF` 등)을 한곳에서 관리할 수 있게 해주는 강력한 기능입니다.

* **구문**:

    ```bitbake
    PACKAGECONFIG ??= "default-feature"
    PACKAGECONFIG[feature] = "--enable-feature,--disable-feature,build-deps,runtime-deps"
    ```

* **예시**:

    ```bitbake
    PACKAGECONFIG ??= "ssl"
    PACKAGECONFIG[ssl] = "--with-ssl,--without-ssl,openssl,openssl"
    PACKAGECONFIG[curl] = "--with-curl,--without-curl,curl"
    ```

    위 예시에서 `PACKAGECONFIG`에 `ssl`이 포함되어 있으므로, `openssl` 의존성이 추가되고 `--with-ssl` 옵션이 configure 스크립트에 전달됩니다.

---
참고: 표준 빌드 시스템을 사용하지 않는 경우(예: 단순 Makefile), `do_configure` 태스크를 비워두거나(`do_configure[noexec] = "1"`), 직접 정의하여 필요한 작업을 수행해야 할 수 있습니다.
